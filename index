<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DREAMPLEX êµìœ¡ê³„íšì„œ ìƒì„±ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, 'SF Pro Display', 'SF Pro', 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            animation: slideUp 0.6s ease-out;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            color: white;
            padding: 60px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/><circle cx="10" cy="60" r="0.5" fill="white" opacity="0.1"/><circle cx="90" cy="40" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }

        .header::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        .logo {
            font-size: 4.5em;
            font-weight: 900;
            margin-bottom: 15px;
            letter-spacing: 8px;
            text-shadow: 0 4px 20px rgba(0,0,0,0.3);
            position: relative;
            z-index: 2;
            background: linear-gradient(45deg, #fff, #f0f0f0, #fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { background-position: -200% center; }
            50% { background-position: 200% center; }
        }

        .subtitle {
            font-size: 1.6em;
            font-weight: 300;
            opacity: 0.95;
            position: relative;
            z-index: 2;
            letter-spacing: 2px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .header-content {
            position: relative;
            z-index: 2;
        }

        .header-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 50px;
            padding: 8px 20px;
            font-size: 0.9em;
            font-weight: 500;
            margin-top: 20px;
            letter-spacing: 1px;
        }
        
        .form-section {
            padding: 40px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: #495057;
            font-size: 1.1em;
        }
        
        .school-select {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            background: white;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .school-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }
        
        .school-select:disabled {
            background: #e9ecef;
            color: #6c757d;
            cursor: not-allowed;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .generate-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            flex: 1;
            min-width: 200px;
        }
        
        .generate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
        }
        
        .generate-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .refresh-btn {
            background: linear-gradient(135deg, #17a2b8 0%, #6f42c1 100%);
            color: white;
            min-width: 120px;
        }
        
        .refresh-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(23, 162, 184, 0.3);
        }
        
        .refresh-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .loading {
            text-align: center;
            padding: 60px 30px;
            background: #f8f9fa;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e9ecef;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading p {
            color: #666;
            font-size: 1.1em;
        }
        
        .plan-result {
            padding: 30px;
            overflow: visible !important;
            height: auto !important;
        }
        
        /* ìƒˆë¡œìš´ êµìœ¡ê³„íšì„œ ë””ìì¸ */
        .education-plan {
            background: white;
            position: relative;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        /* ì¥ì‹ìš© ì›í˜• ìš”ì†Œë“¤ */
        .education-plan::before {
            content: '';
            position: absolute;
            top: -50px;
            left: -50px;
            width: 150px;
            height: 150px;
            background: linear-gradient(135deg, #a8e6cf 0%, #7fcdcd 100%);
            border-radius: 50%;
            opacity: 0.3;
            z-index: 0;
        }
        
        .education-plan::after {
            content: '';
            position: absolute;
            top: 100px;
            right: -80px;
            width: 200px;
            height: 200px;
            background: linear-gradient(135deg, #ffd3a5 0%, #fd9853 100%);
            border-radius: 50%;
            opacity: 0.2;
            z-index: 0;
        }
        
        .decoration-circle {
            position: absolute;
            border-radius: 50%;
            opacity: 0.15;
            z-index: 0;
        }
        
        .decoration-circle-1 {
            top: 60%;
            left: -30px;
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
        }
        
        .decoration-circle-2 {
            bottom: -40px;
            right: 200px;
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }
        
        .plan-content {
            position: relative;
            z-index: 1;
        }
        
        .plan-title {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .plan-title h1 {
            font-size: 2.5em;
            color: #2d5a27;
            font-weight: 900;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .plan-title .highlight {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
            color: #2d5a27;
            font-weight: 700;
        }
        
        .plan-title h2 {
            font-size: 2.2em;
            color: #27ae60;
            font-weight: 800;
            margin-top: 15px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section-title {
            background: linear-gradient(135deg, #ff8c00 0%, #ff6b35 100%);
            color: white;
            padding: 8px 18px;
            border-radius: 12px;
            text-align: center;
            font-size: 1.1em;
            font-weight: 400;
            margin-bottom: 18px;
            box-shadow: 0 2px 6px rgba(255, 140, 0, 0.18);
        }
        
        .basic-info {
            display: grid;
            gap: 15px;
        }
        
        .info-row {
            display: flex;
            align-items: center;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            min-height: 60px;
        }
        
        .info-label {
            background: #27ae60;
            color: white;
            padding: 20px 25px;
            font-weight: 600;
            min-width: 120px;
            text-align: center;
            border-radius: 15px 0 0 15px;
        }
        
        .info-content {
            padding: 20px 25px;
            flex: 1;
            font-weight: 500;
            color: #2c3e50;
            font-size: 1.3em;
        }
        
        .info-content[contenteditable="true"]:focus {
            outline: 2px solid #27ae60;
            background: #f8fff8;
            border-radius: 0 15px 15px 0;
        }
        
        .program-grid {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        /* í”„ë¡œê·¸ë¨ í…Œì´ë¸” ë™ì  ì»¬ëŸ¼ ë„ˆë¹„ ìŠ¤íƒ€ì¼ */
        .program-grid.table-3cols .program-header,
        .program-grid.table-3cols .program-row {
            grid-template-columns: 2fr 1fr 1fr;
        }

        .program-grid.table-4cols .program-header,
        .program-grid.table-4cols .program-row {
            grid-template-columns: 2fr 1fr 1fr 1fr;
        }

        .program-grid.table-5cols .program-header,
        .program-grid.table-5cols .program-row {
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
        }

        .program-header {
            background: #27ae60;
            color: white;
            display: grid;
            gap: 1px;
        }
        
        .program-header div {
            padding: 20px;
            text-align: center;
            font-weight: 600;
            font-size: 1.1em;
        }
        
        .program-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 1px;
            background: #27ae60;
        }
        
        .program-cell {
            background: white;
            padding: 18px 20px;
            text-align: center;
            font-weight: 500;
            color: #2c3e50;
            transition: all 0.3s ease;
            font-size: 1.22em;
        }
        
        .program-cell:hover {
            background: #f8fff8;
        }
        
        .program-cell[contenteditable="true"]:focus {
            outline: 2px solid #27ae60;
            background: #f8fff8;
        }
        
        .program-row:nth-child(even) .program-cell {
            background: #f8f9fa;
        }
        
        .program-row:nth-child(even) .program-cell:hover,
        .program-row:nth-child(even) .program-cell[contenteditable="true"]:focus {
            background: #f8fff8;
        }
        
        .schedule-grid {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .schedule-header {
            background: #27ae60;
            color: white;
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 1px;
        }
        
        .schedule-header div {
            padding: 20px;
            text-align: center;
            font-weight: 600;
            font-size: 1.1em;
        }
        
        .schedule-row {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 1px;
            background: #27ae60;
        }
        
        .schedule-cell {
            background: white;
            padding: 18px 20px;
            font-weight: 500;
            color: #2c3e50;
            transition: all 0.3s ease;
            font-size: 1.22em;
        }
        
        .schedule-cell:first-child {
            text-align: center;
            font-weight: 600;
            background: #f8f9fa;
        }
        
        .schedule-cell:hover {
            background: #f8fff8;
        }
        
        .schedule-cell[contenteditable="true"]:focus {
            outline: 2px solid #27ae60;
            background: #f8fff8;
        }
        
        .schedule-row:nth-child(even) .schedule-cell {
            background: #f8f9fa;
        }
        
        .schedule-row:nth-child(even) .schedule-cell:first-child {
            background: #e9ecef;
        }
        
        .schedule-row:nth-child(even) .schedule-cell:hover,
        .schedule-row:nth-child(even) .schedule-cell[contenteditable="true"]:focus {
            background: #f8fff8;
        }
        
        .note-box {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-left: 5px solid #ffc107;
            padding: 20px 25px;
            border-radius: 0 15px 15px 0;
            margin: 25px 0;
            color: #856404;
            font-weight: 500;
            position: relative;
        }
        
        .note-box::before {
            content: 'ğŸ’¡';
            font-size: 1.2em;
            margin-right: 10px;
        }
        
        .download-section {
            text-align: center;
            padding: 30px 20px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
        }
        
        .download-btn {
            background: linear-gradient(135deg, #fd7e14 0%, #e83e8c 100%);
            color: white;
            margin: 0 8px;
            min-width: 150px;
        }
        
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(253, 126, 20, 0.3);
        }
        
        .save-btn {
            background: linear-gradient(135deg, #6f42c1 0%, #007bff 100%);
            color: white;
            margin: 0 8px;
            min-width: 150px;
        }
        
        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(111, 66, 193, 0.3);
        }
        
        .tab-container {
            margin-bottom: 25px;
        }
        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab-button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: #e9ecef;
            color: #495057;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .contact-form,
        .contact-list {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .contact-list { margin-top: 20px; }
        .contact-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.95em;
        }
        .contact-item:last-child { border-bottom: none; }
        .delete-btn {
            background: #dc3545;
            color: #fff;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85em;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
        }

        .success-message {
            background: #d1edda;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #c3e6cb;
        }

        .date-select {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .date-option {
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .date-option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .date-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .month-select {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .month-option {
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-weight: 600;
            color: #495057;
        }

        .month-option:hover {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .month-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .data-status {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #17a2b8;
            font-size: 0.9em;
        }

        .data-status.loading {
            border-left-color: #ffc107;
            background: #fff3cd;
        }

        .data-status.success {
            border-left-color: #28a745;
            background: #d1edda;
        }

        .data-status.error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }

        .location-radio {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .location-radio label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 500;
            color: #495057;
        }

        /* êµí†µë¹„ ê³„ì‚° ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .transport-tab {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .route-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #2196f3;
        }

        .cost-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .cost-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .cost-item .amount {
            font-size: 1.5em;
            font-weight: bold;
            color: #2196f3;
        }

        .carpool-info {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #ff9800;
        }

        .carpool-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .carpool-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 2px solid #ff9800;
        }

        .carpool-card .passengers {
            font-size: 1.2em;
            font-weight: bold;
            color: #ff9800;
        }

        .carpool-card .cost {
            font-size: 1.1em;
            color: #333;
            margin-top: 5px;
        }

        .kakao-share-btn {
            background: linear-gradient(135deg, #fee500 0%, #ffd700 100%);
            color: #3c1e1e;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }

        .kakao-share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(254, 229, 0, 0.4);
        }

        .fuel-settings {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .fuel-settings input {
            width: 100px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 0 10px;
        }

        .route-details {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid #e9ecef;
        }

        .route-details .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .route-details .detail-item:last-child {
            border-bottom: none;
        }

        .loading-route {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .loading-route .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2196f3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        .api-status-disconnected {
            background-color: #fff0f0;
            color: #d93025;
            border: 1px solid #d93025;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .api-status-connected {
            background-color: #e6f4ea;
            color: #1e8e3e;
            border: 1px solid #1e8e3e;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
        }

        .api-status-testing {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffc107;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
        }

        .plan-title.trendy {
            text-align: center;
            margin-bottom: 60px;
            padding: 40px 0;
            border-bottom: 1px solid #eee;
        }
        .plan-title.trendy .brand-mark {
            display: inline-block;
            font-size: 1.2em;
            font-weight: 600;
            letter-spacing: 2px;
            color: #fff;
            background: linear-gradient(135deg, #6e8efb 0%, #a777e3 100%);
            padding: 8px 18px;
            border-radius: 20px;
            margin-bottom: 30px;
            text-transform: uppercase;
        }
        .plan-title.trendy h1 {
            font-family: -apple-system, 'SF Pro Display', 'SF Pro', 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
            font-size: 3.5em;
            font-weight: 900;
            color: #2c3e50;
            margin: 0 0 10px 0;
        }
        .plan-title.trendy h2 {
            font-family: -apple-system, 'SF Pro Display', 'SF Pro', 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
            font-size: 2em;
            font-weight: 300;
            color: #7f8c8d;
            margin: 0;
            letter-spacing: 4px;
        }

        @media print {
            .download-section, .save-btn { display: none !important; }
            .education-plan::before, .education-plan::after, .decoration-circle { display: none !important; }
            .education-plan {
                box-shadow: none !important;
                border: 1px solid #ddd;
            }
        }

        @media (max-width: 768px) {
            body { padding: 5px; }
            .container { border-radius: 10px; }
            .header { padding: 30px 20px; }
            .logo { font-size: 2.2em; letter-spacing: 2px; }
            .subtitle { font-size: 1.2em; }
            .form-section { padding: 25px 20px; }
            .button-group { flex-direction: column; }
            .generate-btn, .refresh-btn { min-width: auto; width: 100%; }
            .plan-result { padding: 20px 15px; }
            .education-plan { padding: 25px 20px; }
            .plan-title h1 { font-size: 2em; }
            .plan-title h2 { font-size: 1.8em; }
            .info-label { min-width: 100px; padding: 15px 20px; font-size: 0.9em; }
            .program-header, .program-row { grid-template-columns: 2fr 1fr 1fr; }
            .schedule-header, .schedule-row { grid-template-columns: 1fr 2fr; }
            .cost-breakdown { grid-template-columns: 1fr; }
            .carpool-cards { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="logo">DREAMPLEX</div>
                <div class="subtitle">ë“œë¦¼í”Œë ‰ìŠ¤ êµìœ¡ê³„íšì„œ ìƒì„±ê¸°</div>
                <div class="header-badge">AI ê¸°ë°˜ êµìœ¡ ì†”ë£¨ì…˜ v2.0</div>
            </div>
        </div>
        
        <div class="form-section">
            <div id="dataStatus" class="data-status" style="display: none;">
                <div id="statusMessage">ì¤€ë¹„ ì¤‘...</div>
            </div>

            <div class="tab-container">
                <div class="tab-buttons">
                    <button class="tab-button active" onclick="switchTab('plan')">ê³„íšì„œ ìƒì„±</button>
                    <button class="tab-button" onclick="switchTab('contact')">ë‹´ë‹¹ì ë“±ë¡</button>
                    <button class="tab-button" onclick="switchTab('transport')">êµí†µë¹„ ê³„ì‚°</button>
                </div>

                <div id="planTab" class="tab-content active">
                    <div class="form-group">
                        <label>ğŸ“… ì›” ì„ íƒ</label>
                        <div id="monthOptions" class="month-select"></div>
                    </div>

                    <div class="form-group">
                        <label for="schoolSelect">ğŸ« í•™êµ ì„ íƒ</label>
                        <select id="schoolSelect" class="school-select" disabled>
                            <option value="">ë¨¼ì € ì›”ì„ ì„ íƒí•˜ì„¸ìš”...</option>
                        </select>
                    </div>
                    
                    <div id="dateSelectionContainer" class="form-group" style="display: none;">
                        <label>ğŸ“… êµìœ¡ ë‚ ì§œ ì„ íƒ</label>
                        <div id="dateOptions" class="date-select"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="contactSelect">ğŸ‘¤ ë‹´ë‹¹ì ì„ íƒ</label>
                        <select id="contactSelect" class="school-select">
                            <option value="">ë‹´ë‹¹ìë¥¼ ì„ íƒí•˜ì„¸ìš”...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>ğŸ“ ìœ„ì¹˜ ë°°ì • ë°©ì‹</label>
                        <div class="location-radio">
                            <label><input type="radio" name="locationAssignment" value="pre" checked> ì‚¬ì „ ë°°ì •</label>
                            <label><input type="radio" name="locationAssignment" value="onsite"> í˜„ì¥ ë°°ì •</label>
                        </div>
                    </div>
                </div>

                <div id="contactTab" class="tab-content">
                    <div class="contact-form">
                        <div class="form-group">
                            <label for="contactPosition">ì§ì±…</label>
                            <input type="text" id="contactPosition" class="school-select" placeholder="ì˜ˆ: êµì‚¬">
                        </div>
                        <div class="form-group">
                            <label for="contactName">ì´ë¦„</label>
                            <input type="text" id="contactName" class="school-select" placeholder="ì˜ˆ: í™ê¸¸ë™">
                        </div>
                        <div class="form-group">
                            <label for="contactPhone">ì „í™”ë²ˆí˜¸</label>
                            <input type="tel" id="contactPhone" class="school-select" placeholder="ì˜ˆ: 010-1234-5678">
                        </div>
                        <button onclick="addContact()" class="generate-btn">ë“±ë¡</button>
                    </div>
                    <div id="contactList" class="contact-list"></div>
                </div>

                <div id="transportTab" class="tab-content">
                    <div class="transport-tab">
                        <div id="api-status" class="api-status-disconnected">
                            <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                                <span style="font-weight: 600;">ğŸŒ í•˜ì´ë¸Œë¦¬ë“œ API ìƒíƒœ:</span>
                                <span id="api-status-text">ì—°ê²° í™•ì¸ ì¤‘... (êµ¬ê¸€ Maps + ë„¤ì´ë²„ Maps)</span>
                                <button onclick="testAPIConnection()" style="padding: 4px 12px; font-size: 12px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">ğŸ”„ ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                                <button onclick="showGASSetupGuide()" style="padding: 4px 12px; font-size: 12px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">ğŸ“– ì„¤ì • ê°€ì´ë“œ</button>
                                <button onclick="checkCurrentStatus()" style="padding: 4px 12px; font-size: 12px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">ğŸ” í˜„ì¬ ìƒíƒœ</button>
                            </div>
                        </div>

                        <div style="background: #f8f9fa; border-radius: 8px; padding: 15px; margin: 15px 0; border: 1px solid #e9ecef;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #495057;">ğŸ”— Google Apps Script URL ì„¤ì •:</label>
                            <input type="text" id="gasUrlInput" placeholder="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec" 
                                   style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 10px; font-size: 14px;">
                            <div style="display: flex; gap: 10px;">
                                <button onclick="saveGASUrl()" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 600;">ğŸ’¾ URL ì €ì¥</button>
                                <button onclick="loadGASUrl()" style="padding: 8px 16px; background: #17a2b8; color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 600;">ğŸ“‚ URL ë¶ˆëŸ¬ì˜¤ê¸°</button>
                                <button onclick="testAPIConnection()" style="padding: 8px 16px; background: #6f42c1; color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 600;">ğŸ§ª ì „ì²´ í…ŒìŠ¤íŠ¸</button>
                                <button onclick="runSimpleNaverTest()" style="background: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer;">ğŸ”¬ ë„¤ì´ë²„ ì§ì ‘ í˜¸ì¶œ</button>
                                <button onclick="runCompareGeocodeTest()" style="background: #e83e8c; color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer;">ğŸ” í•¨ìˆ˜ ë¹„êµ í…ŒìŠ¤íŠ¸</button>
                                <button onclick="runHybridAPITest()" style="background: #fd7e14; color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer;">ğŸŒ í•˜ì´ë¸Œë¦¬ë“œ API í…ŒìŠ¤íŠ¸</button>
                            </div>
                        </div>

                        <h2 style="color: #495057; margin: 25px 0 15px 0;">ğŸ’° êµí†µë¹„ ê³„ì‚°</h2>
                        <div class="fuel-settings">
                            <label>â›½ ì—°ë¹„ ì„¤ì • (km/L): <input type="number" id="fuelEfficiency" value="12" min="5" max="30" step="0.1"></label>
                            <label>ğŸ’° ìœ ë¥˜ë¹„ (ì›/L): <input type="number" id="fuelPrice" value="1700" min="1000" max="3000" step="10"></label>
                        </div>

                        <div id="routeCalculation" style="display: none;">
                            <div class="route-info">
                                <h4>ğŸ“ ê²½ë¡œ ì •ë³´</h4>
                                <div id="routeDetails" class="route-details">
                                    <div class="detail-item">
                                        <span>ì¶œë°œì§€:</span>
                                        <span>ëŒ€êµ¬ ë¶êµ¬ íƒœí‰ë¡œ 161</span>
                                    </div>
                                    <div class="detail-item">
                                        <span>ëª©ì ì§€:</span>
                                        <span id="destinationSchool">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span>ì´ ê±°ë¦¬:</span>
                                        <span id="totalDistance">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span>ì˜ˆìƒ ì†Œìš”ì‹œê°„:</span>
                                        <span id="estimatedTime">-</span>
                                    </div>
                                </div>
                            </div>

                            <div class="cost-breakdown">
                                <div class="cost-item">
                                    <div>â›½ ì™•ë³µ ì—°ë£Œë¹„</div>
                                    <div class="amount" id="fuelCost">-</div>
                                </div>
                                <div class="cost-item">
                                    <div>ğŸ›£ï¸ ì™•ë³µ í†µí–‰ë£Œ</div>
                                    <div class="amount" id="tollCost">-</div>
                                </div>
                                <div class="cost-item">
                                    <div>ğŸ’° ì´ êµí†µë¹„</div>
                                    <div class="amount" id="totalCost">-</div>
                                </div>
                            </div>

                            <div class="carpool-info">
                                <h4>ğŸ‘¥ ì¹´í’€ë¹„ ì•ˆë‚´</h4>
                                <div class="carpool-cards">
                                    <div class="carpool-card">
                                        <div class="passengers">2ëª…</div>
                                        <div class="cost" id="carpool2">-</div>
                                    </div>
                                    <div class="carpool-card">
                                        <div class="passengers">3ëª…</div>
                                        <div class="cost" id="carpool3">-</div>
                                    </div>
                                    <div class="carpool-card">
                                        <div class="passengers">4ëª…</div>
                                        <div class="cost" id="carpool4">-</div>
                                    </div>
                                </div>
                                
                                <button class="kakao-share-btn" onclick="copyKakaoText()">
                                    ğŸ“‹ ì¹´í†¡ìš© í…ìŠ¤íŠ¸ ë³µì‚¬
                                </button>
                            </div>
                        </div>

                        <div id="loadingRoute" class="loading-route" style="display: none;">
                            <div class="spinner"></div>
                            <p>ê²½ë¡œë¥¼ ê³„ì‚°í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
                        </div>

                        <div id="noRouteData" style="text-align: center; padding: 40px; color: #666;">
                            <p>ğŸ“‹ ë¨¼ì € êµìœ¡ê³„íšì„œë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.</p>
                            <p>ê³„íšì„œ ìƒì„± í›„ ë„¤ì´ë²„ APIë¥¼ í†µí•´ ì •í™•í•œ êµí†µë¹„ê°€ ê³„ì‚°ë©ë‹ˆë‹¤.</p>
                            <br>
                            <div style="background: #e8f5e8; border-radius: 8px; padding: 15px; margin: 15px 0; text-align: left; font-size: 14px; border: 1px solid #4caf50;">
                                <h4 style="margin-top: 0; color: #2e7d32;">ğŸŒ í•˜ì´ë¸Œë¦¬ë“œ API ëª¨ë“œ (êµ¬ê¸€ + ë„¤ì´ë²„)</h4>
                                <p><strong>ğŸ” êµ¬ê¸€ Maps API:</strong> ì£¼ì†Œ ê²€ìƒ‰ ë° í•œê¸€ ë„ë¡œëª… ì£¼ì†Œ ë°˜í™˜</p>
                                <p><strong>ğŸ“ ë„¤ì´ë²„ Maps API:</strong> ì •í™•í•œ ì¢Œí‘œ ë³€í™˜ ë° ê²½ë¡œ ê³„ì‚° (í†µí–‰ë£Œ, ì—°ë£Œë¹„)</p>
                                <p><strong>âœ… ìµœì  ì¡°í•©:</strong> êµ¬ê¸€ì˜ ì£¼ì†Œ ê²€ìƒ‰ + ë„¤ì´ë²„ì˜ ì •í™•í•œ ê²½ë¡œ ë°ì´í„°</p>
                                <p><strong>ğŸ”§ í•„ìˆ˜ ì„¤ì •:</strong> Google Apps Script URL ì„¤ì • í›„ ì‚¬ìš© ê°€ëŠ¥</p>
                                <p><strong>ğŸ”‘ API í‚¤:</strong> êµ¬ê¸€ Maps API í‚¤ + ë„¤ì´ë²„ Maps API í‚¤ ìë™ ì ìš©</p>
                            </div>
                            <div style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
                                <button class="kakao-share-btn" onclick="showGoogleAppsScriptGuide()" style="background: linear-gradient(135deg, #17a2b8 0%, #6f42c1 100%); color: white;">
                                    ğŸ”§ GAS ì„¤ì • ê°€ì´ë“œ
                                </button>
                                <button class="kakao-share-btn" onclick="testManualRoute()" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white;">
                                    ğŸ§ª ë„¤ì´ë²„ API í…ŒìŠ¤íŠ¸
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="button-group">
                <label style="display:inline-block;">
                    <input type="file" id="csvUpload" accept=".csv" style="display:none;" onchange="handleCSVUpload(event)">
                    <button type="button" class="refresh-btn" style="background:linear-gradient(135deg,#fd7e14 0%,#20c997 100%);color:white;" onclick="document.getElementById('csvUpload').click();">ğŸ“ CSV ì—…ë¡œë“œ</button>
                </label>
                <button onclick="generatePlan()" id="generateBtn" class="generate-btn" disabled>
                    ğŸ“‹ ê³„íšì„œ ìƒì„±í•˜ê¸°
                </button>
            </div>
        </div>
        
        <div id="loading" class="loading" style="display:none;">
            <div class="spinner"></div>
            <p>êµìœ¡ê³„íšì„œë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
        </div>
        
        <div id="planResult" class="plan-result"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
    <script>
        // ì „ì—­ ë³€ìˆ˜ë“¤
        var schoolData = [];
        var dataByMonth = {};
        var contacts = [];
        var selectedMonth = null;
        var selectedDate = null;
        var isDataLoaded = false;
        var planData = null;

        // êµí†µë¹„ ê³„ì‚° ê´€ë ¨ ë³€ìˆ˜
        var transportData = {
            distance: 0,
            duration: 0,
            tollFare: 0,
            fuelPrice: 0,
            totalCost: 0
        };

        // Google Apps Script URL - ìˆ˜ì •ëœ ë³€ìˆ˜ëª…
        var GAS_URL = localStorage.getItem('gasUrl') || '';

        // ì´ˆê¸°í™” í•¨ìˆ˜
        function initializeApp() {
            console.log('=== DREAMPLEX ì•± ì´ˆê¸°í™” ===');
            
            // ì €ì¥ëœ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
            loadSavedSettings();
            
            // API ìƒíƒœ í™•ì¸
            checkAPIStatus();
            
            // ì—°ë½ì²˜ ëª©ë¡ ì—…ë°ì´íŠ¸
            updateContactList();
            updateContactSelect();
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            setupEventListeners();
            
            console.log('âœ… ì•± ì´ˆê¸°í™” ì™„ë£Œ');
        }

        // ì €ì¥ëœ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
        function loadSavedSettings() {
            // GAS URL ë¶ˆëŸ¬ì˜¤ê¸°
            var savedUrl = localStorage.getItem('gasUrl');
            if (savedUrl) {
                document.getElementById('gasUrlInput').value = savedUrl;
                GAS_URL = savedUrl;
                console.log('âœ… ì €ì¥ëœ GAS URL ë¶ˆëŸ¬ì˜´');
            }
            
            // ì—°ë½ì²˜ ë¶ˆëŸ¬ì˜¤ê¸°
            var savedContacts = localStorage.getItem('contacts');
            if (savedContacts) {
                try {
                    contacts = JSON.parse(savedContacts);
                    console.log('âœ… ì €ì¥ëœ ì—°ë½ì²˜ ë¶ˆëŸ¬ì˜´:', contacts.length + 'ê°œ');
                } catch (e) {
                    console.warn('ì—°ë½ì²˜ ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨:', e);
                    contacts = [];
                }
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupEventListeners() {
            document.getElementById('schoolSelect').addEventListener('change', onSchoolSelect);
            document.getElementById('contactSelect').addEventListener('change', checkGenerateBtn);
            
            // ì—°ë¹„/ìœ ë¥˜ë¹„ ë³€ê²½ ì‹œ ì¬ê³„ì‚°
            document.getElementById('fuelEfficiency').addEventListener('change', function() {
                if (transportData.totalCost > 0) {
                    updateTransportDisplay();
                }
            });
            
            document.getElementById('fuelPrice').addEventListener('change', function() {
                if (transportData.totalCost > 0) {
                    updateTransportDisplay();
                }
            });
        }

        // ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateStatus(type, message) {
            var statusDiv = document.getElementById('dataStatus');
            var statusMessage = document.getElementById('statusMessage');
            statusDiv.style.display = 'block';
            statusDiv.className = 'data-status ' + type;
            statusMessage.textContent = message;
        }

        // API ìƒíƒœ í™•ì¸ (ë„¤ì´ë²„ API ì „ìš©)
        function checkAPIStatus() {
            const apiStatusDiv = document.getElementById('api-status');
            const apiStatusSpan = document.getElementById('api-status-text');
            
            console.log('=== ë„¤ì´ë²„ API ìƒíƒœ í™•ì¸ ===');
            console.log('GAS_URL:', GAS_URL);
            
            if (!GAS_URL || GAS_URL.includes('YOUR_SCRIPT_ID')) {
                apiStatusDiv.className = 'api-status-disconnected';
                apiStatusSpan.textContent = 'âŒ URL ë¯¸ì„¤ì • (GAS URL ì…ë ¥ í•„ìš”)';
                console.log('âŒ GAS URLì´ ì„¤ì •ë˜ì§€ ì•ŠìŒ');
                return;
            }
            
            if (!GAS_URL.startsWith('https://script.google.com/')) {
                apiStatusDiv.className = 'api-status-disconnected';
                apiStatusSpan.textContent = 'âŒ ì˜ëª»ëœ URL í˜•ì‹';
                console.log('âŒ ì˜ëª»ëœ URL í˜•ì‹');
                return;
            }
            
            // ì‹¤ì œ ì—°ê²° í…ŒìŠ¤íŠ¸
            apiStatusDiv.className = 'api-status-testing';
            apiStatusSpan.textContent = 'ğŸ”„ ë„¤ì´ë²„ API ì—°ê²° í™•ì¸ ì¤‘...';
            
            testAPIConnectionSilent()
                .then(success => {
                    if (success) {
                        apiStatusDiv.className = 'api-status-connected';
                        apiStatusSpan.textContent = 'âœ… ì—°ê²°ë¨ (ë„¤ì´ë²„ API í™œì„±)';
                        console.log('âœ… ë„¤ì´ë²„ API ì—°ê²° ì„±ê³µ');
                    } else {
                        apiStatusDiv.className = 'api-status-disconnected';
                        apiStatusSpan.textContent = 'âŒ ì—°ê²° ì‹¤íŒ¨ (ë„¤ì´ë²„ API ì˜¤ë¥˜)';
                        console.log('âŒ ë„¤ì´ë²„ API ì—°ê²° ì‹¤íŒ¨');
                    }
                })
                .catch(error => {
                    apiStatusDiv.className = 'api-status-disconnected';
                    apiStatusSpan.textContent = 'âŒ ì—°ê²° ì‹¤íŒ¨ (ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜)';
                    console.log('âŒ ë„¤ì´ë²„ API ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
                });
        }

        // í˜„ì¬ ìƒíƒœ í™•ì¸ í•¨ìˆ˜ (ë””ë²„ê¹…ìš©)
        function checkCurrentStatus() {
            console.log('=== í˜„ì¬ ìƒíƒœ í™•ì¸ ===');
            
            var statusInfo = {
                gasUrl: GAS_URL || 'ë¯¸ì„¤ì •',
                localStorageUrl: localStorage.getItem('gasUrl') || 'ë¯¸ì„¤ì •',
                inputValue: document.getElementById('gasUrlInput').value || 'ë¯¸ì„¤ì •',
                timestamp: new Date().toLocaleString()
            };
            
            console.log('ìƒíƒœ ì •ë³´:', statusInfo);
            
            var message = 'ğŸ” í˜„ì¬ ìƒíƒœ ì •ë³´:\n\n';
            message += 'ğŸ“¡ GAS URL: ' + statusInfo.gasUrl + '\n';
            message += 'ğŸ’¾ ì €ì¥ëœ URL: ' + statusInfo.localStorageUrl + '\n';
            message += 'ğŸ“ ì…ë ¥ í•„ë“œ: ' + statusInfo.inputValue + '\n';
            message += 'â° í™•ì¸ ì‹œê°„: ' + statusInfo.timestamp + '\n\n';
            
            if (!GAS_URL || GAS_URL.includes('YOUR_SCRIPT_ID')) {
                message += 'âŒ ë¬¸ì œ: Google Apps Script URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n\n';
                message += 'ğŸ’¡ í•´ê²° ë°©ë²•:\n';
                message += '1. Google Apps Scriptì—ì„œ "ë°°í¬" â†’ "ìƒˆ ë°°í¬" ì‹¤í–‰\n';
                message += '2. ìƒì„±ëœ ì›¹ì•± URLì„ ìœ„ ì…ë ¥ í•„ë“œì— ë¶™ì—¬ë„£ê¸°\n';
                message += '3. "URL ì €ì¥" ë²„íŠ¼ í´ë¦­\n';
                message += '4. "ì—°ê²° í…ŒìŠ¤íŠ¸" ë²„íŠ¼ìœ¼ë¡œ í™•ì¸';
            } else if (!GAS_URL.startsWith('https://script.google.com/')) {
                message += 'âŒ ë¬¸ì œ: URL í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\n';
                message += 'ğŸ’¡ ì˜¬ë°”ë¥¸ í˜•ì‹:\n';
                message += 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec';
            } else {
                message += 'âœ… URL í˜•ì‹ì´ ì˜¬ë°”ë¦…ë‹ˆë‹¤.\n';
                message += 'ğŸ”„ "ì—°ê²° í…ŒìŠ¤íŠ¸" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì‹¤ì œ ì—°ê²°ì„ í™•ì¸í•´ë³´ì„¸ìš”.';
            }
            
            alert(message);
        }

        // ë¬´ìŒ API ì—°ê²° í…ŒìŠ¤íŠ¸
        function testAPIConnectionSilent() {
            if (!GAS_URL || GAS_URL.includes('YOUR_SCRIPT_ID')) {
                return Promise.resolve(false);
            }
            
            return fetch(GAS_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    action: 'testConnection'
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('HTTP error: ' + response.status);
                }
                return response.json();
            })
            .then(data => {
                return data.status === 'success';
            })
            .catch(error => {
                console.log('ë¬´ìŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error.message);
                return false;
            });
        }

        // API ì—°ê²° í…ŒìŠ¤íŠ¸ (ì‚¬ìš©ììš©)
        function testAPIConnection() {
            console.log('=== API ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
            
            if (!GAS_URL || GAS_URL.includes('YOUR_SCRIPT_ID')) {
                alert('âš ï¸ Google Apps Script URLì„ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const apiStatusSpan = document.getElementById('api-status-text');
            apiStatusSpan.textContent = 'ğŸ”„ ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            fetch(GAS_URL, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ action: 'testConnection' })
            })
            .then(response => {
                if (!response.ok) throw new Error(`HTTP ì˜¤ë¥˜! ìƒíƒœ: ${response.status}`);
                return response.json();
            })
            .then(data => {
                console.log('âœ… API ì—°ê²° í…ŒìŠ¤íŠ¸ ì‘ë‹µ:', data);
                
                const finalStatus = data.status;
                document.getElementById('api-status').className = finalStatus === 'success' ? 'api-status-connected' : 'api-status-disconnected';
                apiStatusSpan.textContent = finalStatus === 'success' ? 'âœ… ì—°ê²°ë¨ (í…ŒìŠ¤íŠ¸ ì„±ê³µ)' : 'âŒ ì—°ê²° ì‹¤íŒ¨';

                let message = `API ì—°ê²° í…ŒìŠ¤íŠ¸ ê²°ê³¼ (ìƒíƒœ: ${finalStatus})\n\n`;
                message += `===== ë„¤ì´ë²„ API =====\n`;
                message += `ìƒíƒœ: ${data.data.naverApi.status}\n`;
                message += `ë©”ì‹œì§€: ${data.data.naverApi.message}\n\n`;
                message += `===== ìŠ¤í”„ë ˆë“œì‹œíŠ¸ =====\n`;
                message += `ìƒíƒœ: ${data.data.spreadsheet.status}\n`;
                message += `ë©”ì‹œì§€: ${data.data.spreadsheet.message}\n\n`;

                if (finalStatus !== 'success') {
                    message += "ğŸ’¡ í•´ê²° ë°©ë²•:\n";
                    message += "- 'ë©”ì‹œì§€' ë‚´ìš©ì„ ë³µì‚¬í•´ì„œ ê°œë°œìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.\n";
                    message += "- ë„¤ì´ë²„ API ì˜¤ë¥˜ ì‹œ: ë„¤ì´ë²„ í´ë¼ìš°ë“œ í”Œë«í¼ì—ì„œ APIê°€ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€, í˜¸ì¶œ í•œë„ë¥¼ ì´ˆê³¼í•˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.\n";
                    message += "- ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì˜¤ë¥˜ ì‹œ: ì‹œíŠ¸ IDë‚˜ ì´ë¦„ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•˜ì„¸ìš”.";
                }
                
                alert(message);
            })
            .catch(error => {
                console.error('âŒ API ì—°ê²° ì‹¤íŒ¨:', error);
                document.getElementById('api-status').className = 'api-status-disconnected';
                apiStatusSpan.textContent = 'âŒ ì—°ê²° ì‹¤íŒ¨';
                
                var errorMessage = 'âŒ API ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                errorMessage += '\n\nğŸ” ì˜¤ë¥˜ ì •ë³´:';
                errorMessage += '\n- ì˜¤ë¥˜: ' + error.message;
                
                if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
                    errorMessage += '\n\nğŸš« ê°€ëŠ¥í•œ ì›ì¸:';
                    errorMessage += '\n1. Google Apps Scriptê°€ ë°°í¬ë˜ì§€ ì•ŠìŒ';
                    errorMessage += '\n2. ì•¡ì„¸ìŠ¤ ê¶Œí•œì´ "ëª¨ë“  ì‚¬ìš©ì"ë¡œ ì„¤ì •ë˜ì§€ ì•ŠìŒ';
                    errorMessage += '\n3. ì˜ëª»ëœ URL';
                    errorMessage += '\n4. ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë¬¸ì œ';
                }
                
                errorMessage += '\n\nğŸ’¡ í•´ê²° ë°©ë²•:';
                errorMessage += '\n1. "ì„¤ì • ê°€ì´ë“œ" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë‹¨ê³„ë³„ ì„¤ì • í™•ì¸';
                errorMessage += '\n2. Google Apps Script ì¬ë°°í¬';
                errorMessage += '\n3. ìƒˆë¡œìš´ ë°°í¬ URLë¡œ ì—…ë°ì´íŠ¸';
                
                alert(errorMessage);
            });
        }

        // ì „ì²´ API í…ŒìŠ¤íŠ¸
        function testFullAPI() {
            if (!GAS_URL || GAS_URL.includes('YOUR_SCRIPT_ID')) {
                alert('âš ï¸ Google Apps Script URLì„ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            console.log('=== ì „ì²´ API í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
            
            var testData = {
                action: 'getRoute',
                origin: 'ëŒ€êµ¬ ë¶êµ¬ íƒœí‰ë¡œ 161',
                destination: 'ëŒ€êµ¬ê´‘ì—­ì‹œì²­'
            };
            
            console.log('ì „ì²´ í…ŒìŠ¤íŠ¸ ë°ì´í„°:', testData);
            
            fetch(GAS_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(testData)
            })
            .then(response => {
                console.log('ì „ì²´ í…ŒìŠ¤íŠ¸ ì‘ë‹µ ìƒíƒœ:', response.status);
                if (!response.ok) {
                    throw new Error('HTTP error: ' + response.status);
                }
                return response.json();
            })
            .then(data => {
                console.log('âœ… ì „ì²´ API í…ŒìŠ¤íŠ¸ ì„±ê³µ:', data);
                
                if (data.status === 'success') {
                    var routeData = data.data;
                    var message = 'ğŸ‰ ì „ì²´ API í…ŒìŠ¤íŠ¸ ì„±ê³µ!';
                    message += '\n\nğŸ“ ê²½ë¡œ ì •ë³´:';
                    message += '\n- ê±°ë¦¬: ' + routeData.distance + 'km';
                    message += '\n- ì‹œê°„: ' + routeData.duration + 'ë¶„';
                    message += '\n- í†µí–‰ë£Œ: ' + routeData.tollFare + 'ì›';
                    message += '\n- ì—°ë£Œë¹„: ' + routeData.fuelPrice + 'ì›';
                    
                    if (routeData.source) {
                        message += '\n\nğŸ“Š ë°ì´í„° ì†ŒìŠ¤:';
                        message += '\n- í†µí–‰ë£Œ: ' + (routeData.source.tollFare.startsWith('naver_') ? 'ë„¤ì´ë²„ API' : 'ê³„ì‚°');
                        message += '\n- ì—°ë£Œë¹„: ' + (routeData.source.fuelPrice.startsWith('naver_') ? 'ë„¤ì´ë²„ API' : 'ê³„ì‚°');
                    }
                    
                    alert(message);
                } else {
                    throw new Error(data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
                }
                
            })
            .catch(error => {
                console.error('âŒ ì „ì²´ API í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error);
                alert('âŒ ì „ì²´ API í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + error.message);
            });
        }

        // ìˆ˜ë™ ê²½ë¡œ í…ŒìŠ¤íŠ¸ (ë„¤ì´ë²„ API ì „ìš©)
        function testManualRoute() {
            var destination = prompt('í…ŒìŠ¤íŠ¸í•  ëª©ì ì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”:', 'ëŒ€êµ¬ê´‘ì—­ì‹œì²­');
            if (!destination) return;
            
            console.log('=== ìˆ˜ë™ ê²½ë¡œ í…ŒìŠ¤íŠ¸ ì‹œì‘ (ë„¤ì´ë²„ API ì „ìš©) ===');
            console.log('ëª©ì ì§€:', destination);
            
            if (!GAS_URL || GAS_URL.includes('YOUR_SCRIPT_ID')) {
                alert('âš ï¸ Google Apps Script URLì„ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.\n\në„¤ì´ë²„ APIì—ì„œ ì •í™•í•œ tollFareì™€ fuelPriceë¥¼ ë°›ì•„ì˜¤ë ¤ë©´ GAS ì„¤ì •ì´ í•„ìˆ˜ì…ë‹ˆë‹¤.');
                return;
            }
            
            showLoadingRoute();
            
            callGoogleAppsScript({
                action: 'getRoute',
                origin: 'ëŒ€êµ¬ ë¶êµ¬ íƒœí‰ë¡œ 161',
                destination: destination
            })
            .then(response => {
                hideLoadingRoute();
                
                if (response && response.status === 'success') {
                    console.log('âœ… ë„¤ì´ë²„ API ìˆ˜ë™ í…ŒìŠ¤íŠ¸ ì„±ê³µ:', response);
                    
                    var data = response.data;
                    
                    // ë„¤ì´ë²„ APIì—ì„œ tollFareì™€ fuelPriceë¥¼ ì œëŒ€ë¡œ ë°›ì•˜ëŠ”ì§€ í™•ì¸
                    if (data.tollFare === 0 && data.fuelPrice === 0) {
                        alert('âš ï¸ ë„¤ì´ë²„ APIì—ì„œ tollFareì™€ fuelPriceë¥¼ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\n' +
                              'ê±°ë¦¬: ' + data.distance + 'km\n' +
                              'ì‹œê°„: ' + data.duration + 'ë¶„\n' +
                              'í†µí–‰ë£Œ: ' + data.tollFare + 'ì›\n' +
                              'ì—°ë£Œë¹„: ' + data.fuelPrice + 'ì›\n\n' +
                              'ë””ë²„ê·¸ ì •ë³´ë¥¼ ì½˜ì†”ì—ì„œ í™•ì¸í•´ì£¼ì„¸ìš”.');
                        return;
                    }
                    
                    // ì„ì‹œë¡œ planData ì„¤ì •
                    planData = {
                        school: {
                            name: destination
                        }
                    };
                    
                    // êµí†µë¹„ ë°ì´í„° ì—…ë°ì´íŠ¸
                    processRouteData(response.data);
                    
                    alert('âœ… ë„¤ì´ë²„ API í…ŒìŠ¤íŠ¸ ì„±ê³µ!\n\n' +
                          'ê±°ë¦¬: ' + data.distance + 'km\n' +
                          'ì‹œê°„: ' + data.duration + 'ë¶„\n' +
                          'í¸ë„ í†µí–‰ë£Œ: ' + data.tollFare.toLocaleString() + 'ì›\n' +
                          'í¸ë„ ì—°ë£Œë¹„: ' + data.fuelPrice.toLocaleString() + 'ì›\n' +
                          'ì™•ë³µ ì´ ë¹„ìš©: ' + ((data.tollFare + data.fuelPrice) * 2).toLocaleString() + 'ì›');
                } else {
                    throw new Error(response.message || 'ë„¤ì´ë²„ API í˜¸ì¶œ ì‹¤íŒ¨');
                }
            })
            .catch(error => {
                hideLoadingRoute();
                console.error('âŒ ë„¤ì´ë²„ API ìˆ˜ë™ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error);
                alert('âŒ ë„¤ì´ë²„ API í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:\n\n' + error.message + '\n\nì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            });
        }

        // GAS URL ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
        function saveGASUrl() {
            var url = document.getElementById('gasUrlInput').value.trim();
            if (!url) {
                alert('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!url.startsWith('https://script.google.com/')) {
                alert('ì˜¬ë°”ë¥¸ Google Apps Script URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\n\nì˜ˆì‹œ: https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec');
                return;
            }
            
            localStorage.setItem('gasUrl', url);
            GAS_URL = url;
            
            // ì €ì¥ í›„ ìë™ìœ¼ë¡œ ì—°ê²° í…ŒìŠ¤íŠ¸
            checkAPIStatus();
            
            alert('âœ… URLì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ìˆìŠµë‹ˆë‹¤...');
        }

        function loadGASUrl() {
            var savedUrl = localStorage.getItem('gasUrl');
            if (savedUrl) {
                document.getElementById('gasUrlInput').value = savedUrl;
                GAS_URL = savedUrl;
                checkAPIStatus();
                alert('âœ… ì €ì¥ëœ URLì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
            } else {
                alert('âš ï¸ ì €ì¥ëœ URLì´ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // Google Apps Script ì„¤ì • ê°€ì´ë“œ
        function showGASSetupGuide() {
            var guideText = `
ğŸ”§ Google Apps Script ì„¤ì • ê°€ì´ë“œ

ğŸ“‹ 1ë‹¨ê³„: ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±
â€¢ https://script.google.com ì ‘ì†
â€¢ "ìƒˆ í”„ë¡œì íŠ¸" í´ë¦­

ğŸ“‹ 2ë‹¨ê³„: ì½”ë“œ ë¶™ì—¬ë„£ê¸°
â€¢ Code.gs íŒŒì¼ì— ì œê³µëœ ì½”ë“œ ì „ì²´ ë³µì‚¬ í›„ ë¶™ì—¬ë„£ê¸°
â€¢ ì €ì¥ (Ctrl+S)

ğŸ“‹ 3ë‹¨ê³„: í™˜ê²½ë³€ìˆ˜ ì„¤ì • (ì„ íƒì‚¬í•­)
â€¢ ì„¤ì •(âš™ï¸) > ìŠ¤í¬ë¦½íŠ¸ ì†ì„±
â€¢ NAVER_CLIENT_ID: ë„¤ì´ë²„ í´ë¼ì´ì–¸íŠ¸ ID
â€¢ NAVER_CLIENT_SECRET: ë„¤ì´ë²„ í´ë¼ì´ì–¸íŠ¸ ì‹œí¬ë¦¿

ğŸ“‹ 4ë‹¨ê³„: ë°°í¬
â€¢ "ë°°í¬" > "ìƒˆ ë°°í¬" í´ë¦­
â€¢ ìœ í˜•: "ì›¹ ì•±" ì„ íƒ
â€¢ ì„¤ëª…: "DREAMPLEX API v2.0"
â€¢ ì‹¤í–‰ ê³„ì •: "ë‚˜"
â€¢ ì•¡ì„¸ìŠ¤ ê¶Œí•œ: "ëª¨ë“  ì‚¬ìš©ì" â­ì¤‘ìš”â­
â€¢ "ë°°í¬" í´ë¦­

ğŸ“‹ 5ë‹¨ê³„: URL ë³µì‚¬ ë° ì„¤ì •
â€¢ ìƒì„±ëœ ì›¹ì•± URL ë³µì‚¬
â€¢ ì´ í˜ì´ì§€ì˜ "Google Apps Script URL ì„¤ì •"ì— ë¶™ì—¬ë„£ê¸°
â€¢ "URL ì €ì¥" í´ë¦­

ğŸ“‹ 6ë‹¨ê³„: í…ŒìŠ¤íŠ¸
â€¢ "ì—°ê²° í…ŒìŠ¤íŠ¸" ë²„íŠ¼ìœ¼ë¡œ í™•ì¸
â€¢ "ì „ì²´ í…ŒìŠ¤íŠ¸" ë²„íŠ¼ìœ¼ë¡œ ê²½ë¡œ ê³„ì‚° í…ŒìŠ¤íŠ¸

â— ì£¼ì˜ì‚¬í•­:
â€¢ ì•¡ì„¸ìŠ¤ ê¶Œí•œì€ ë°˜ë“œì‹œ "ëª¨ë“  ì‚¬ìš©ì"ë¡œ ì„¤ì •
â€¢ ë°°í¬ í›„ URLì´ ë³€ê²½ë˜ë©´ ë‹¤ì‹œ ì„¤ì • í•„ìš”
â€¢ ì²˜ìŒ ì‹¤í–‰ ì‹œ ê¶Œí•œ ìŠ¹ì¸ í•„ìš”

ğŸ’¡ ë¬¸ì œ í•´ê²°:
â€¢ CORS ì˜¤ë¥˜: ì•¡ì„¸ìŠ¤ ê¶Œí•œ "ëª¨ë“  ì‚¬ìš©ì" ì¬í™•ì¸
â€¢ 403 ì˜¤ë¥˜: ë„¤ì´ë²„ API í‚¤ í™•ì¸
â€¢ 500 ì˜¤ë¥˜: ì½”ë“œ ì˜¤íƒ€ í™•ì¸
            `;
            
            alert(guideText);
        }

        function showGoogleAppsScriptGuide() {
            showGASSetupGuide();
        }

        // ì›” ì¶”ì¶œ í•¨ìˆ˜
        function extractMonth(dateString) {
            if (!dateString) return null;
            var match = dateString.match(/25\.(\d{2})\./);
            if (match) {
                var month = parseInt(match[1]);
                return '2025-' + (month < 10 ? '0' + month : month);
            }
            return null;
        }

        // ì›”ë³„ ë°ì´í„° ê·¸ë£¹í™”
        function groupDataByMonth(data) {
            var grouped = {};
            for (var i = 0; i < data.length; i++) {
                var item = data[i];
                var month = extractMonth(item['ì²´í—˜ì¼']);
                if (month) {
                    if (!grouped[month]) {
                        grouped[month] = [];
                    }
                    grouped[month].push(item);
                }
            }
            return grouped;
        }

        // CSV ì—…ë¡œë“œ ì²˜ë¦¬
        function handleCSVUpload(event) {
            var file = event.target.files[0];
            if (!file) {
                updateStatus('error', 'âŒ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!file.name.endsWith('.csv')) {
                updateStatus('error', 'âŒ CSV íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                event.target.value = '';
                return;
            }
            updateStatus('loading', 'ğŸ”„ CSV íŒŒì¼ì„ ì²˜ë¦¬í•˜ëŠ” ì¤‘...');
            var reader = new FileReader();
            reader.onload = function(e) {
                Papa.parse(e.target.result, {
                    header: true,
                    skipEmptyLines: true,
                    encoding: 'UTF-8',
                    complete: function(results) {
                        try {
                            var data = results.data;
                            if (!data || data.length === 0) {
                                throw new Error('CSV íŒŒì¼ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.');
                            }
                            var requiredHeaders = ['ì²´í—˜ì¼', 'í•™êµ', 'ìˆ˜ì—…', 'ìˆ˜ì—…ì‹œê°„', 'ì°¨ì‹œ'];
                            var headers = Object.keys(data[0] || {});
                            var missingHeaders = requiredHeaders.filter(h => !headers.includes(h));
                            if (missingHeaders.length > 0) {
                                throw new Error('í•„ìˆ˜ ì—´ì´ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤: ' + missingHeaders.join(', '));
                            }
                            schoolData = data.map(row => {
                                var rowObj = {};
                                headers.forEach(h => {
                                    rowObj[h] = row[h] !== null && row[h] !== undefined ? row[h].toString() : '';
                                });
                                return rowObj;
                            }).filter(row => row['ì²´í—˜ì¼'] && row['í•™êµ'] && row['ìˆ˜ì—…ì‹œê°„'] && row['ì°¨ì‹œ']);
                            if (schoolData.length === 0) {
                                throw new Error('ìœ íš¨í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                            }
                            dataByMonth = groupDataByMonth(schoolData);
                            isDataLoaded = true;
                            var monthCount = Object.keys(dataByMonth).length;
                            updateStatus('success', 'âœ… ì„±ê³µ! ' + schoolData.length + 'ê°œì˜ êµìœ¡ ì¼ì •ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. (' + monthCount + 'ê°œì›”, ìµœì¢… ì—…ë°ì´íŠ¸: ' + new Date().toLocaleString() + ')');
                            updateMonthOptions();
                            event.target.value = '';
                        } catch (error) {
                            console.error('CSV ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                            updateStatus('error', 'âŒ CSV ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                            event.target.value = '';
                        }
                    },
                    error: function(error) {
                        console.error('CSV íŒŒì‹± ì˜¤ë¥˜:', error);
                        updateStatus('error', 'âŒ CSV íŒŒì‹± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                        event.target.value = '';
                    }
                });
            };
            reader.readAsText(file);
        }

        // ì›” ì˜µì…˜ ì—…ë°ì´íŠ¸
        function updateMonthOptions() {
            var monthContainer = document.getElementById('monthOptions');
            monthContainer.innerHTML = '';
            var availableMonths = Object.keys(dataByMonth).sort();
            if (availableMonths.length === 0) {
                monthContainer.innerHTML = '<div style="text-align: center; color: #6c757d; padding: 20px;">ì‚¬ìš© ê°€ëŠ¥í•œ ì›”ì´ ì—†ìŠµë‹ˆë‹¤. CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.</div>';
                return;
            }
            var monthNames = {
                '2025-06': '2025ë…„ 6ì›”',
                '2025-07': '2025ë…„ 7ì›”',
                '2025-08': '2025ë…„ 8ì›”',
                '2025-09': '2025ë…„ 9ì›”',
                '2025-10': '2025ë…„ 10ì›”',
                '2025-11': '2025ë…„ 11ì›”',
                '2025-12': '2025ë…„ 12ì›”'
            };
            for (var i = 0; i < availableMonths.length; i++) {
                var month = availableMonths[i];
                var monthDiv = document.createElement('div');
                monthDiv.className = 'month-option';
                monthDiv.setAttribute('data-month', month);
                monthDiv.onclick = function() { selectMonth(this.getAttribute('data-month'), this); };
                var schools = {};
                for (var j = 0; j < dataByMonth[month].length; j++) {
                    schools[dataByMonth[month][j]['í•™êµ']] = true;
                }
                var schoolCount = Object.keys(schools).length;
                monthDiv.innerHTML = (monthNames[month] || month) + '<br><small style="opacity: 0.8;">' + schoolCount + 'ê°œ í•™êµ</small>';
                monthContainer.appendChild(monthDiv);
            }
        }

        // ì›” ì„ íƒ
        function selectMonth(month, element) {
            var monthOptions = document.querySelectorAll('.month-option');
            for (var i = 0; i < monthOptions.length; i++) {
                monthOptions[i].classList.remove('selected');
            }
            element.classList.add('selected');
            selectedMonth = month;
            updateSchoolSelect();
            resetDateSelection();
            checkGenerateBtn();
        }

        // í•™êµ ì„ íƒ ì—…ë°ì´íŠ¸
        function updateSchoolSelect() {
            var schoolSelect = document.getElementById('schoolSelect');
            if (!selectedMonth || !dataByMonth[selectedMonth]) {
                schoolSelect.innerHTML = '<option value="">ë¨¼ì € ì›”ì„ ì„ íƒí•˜ì„¸ìš”...</option>';
                schoolSelect.disabled = true;
                return;
            }

            var monthData = dataByMonth[selectedMonth];
            var schools = {};

            for (var i = 0; i < monthData.length; i++) {
                var item = monthData[i];
                var schoolName = item['í•™êµ'];
                var address = item['ì£¼ì†Œ'] || item['ì§€ì—­'] || ''; 
                var uniqueKey = schoolName + '___' + address;

                if (schoolName) {
                    if (!schools[uniqueKey]) {
                        schools[uniqueKey] = {
                            name: schoolName,
                            address: address,
                            dates: new Set(),
                            originalIndex: i 
                        };
                    }
                    schools[uniqueKey].dates.add(item['ì²´í—˜ì¼']);
                }
            }

            var uniqueSchools = Object.values(schools).sort((a, b) => a.name.localeCompare(b.name));
            
            schoolSelect.disabled = false;
            schoolSelect.innerHTML = '<option value="">í•™êµë¥¼ ì„ íƒí•˜ì„¸ìš”...</option>';

            for (var i = 0; i < uniqueSchools.length; i++) {
                var school = uniqueSchools[i];
                var option = document.createElement('option');
                var displayText = school.name;
                if (school.address) {
                    displayText += ' (' + school.address + ')';
                }
                
                option.value = school.name + '___' + school.address;
                option.textContent = displayText;
                schoolSelect.appendChild(option);
            }
        }

        // í•™êµ ì„ íƒ ì´ë²¤íŠ¸
        function onSchoolSelect() {
            var selectedValue = document.getElementById('schoolSelect').value;
            if (!selectedValue) {
                resetDateSelection();
                return;
            }

            var [selectedSchool, selectedAddress] = selectedValue.split('___');
            var dateContainer = document.getElementById('dateSelectionContainer');
            var dateOptions = document.getElementById('dateOptions');

            if (selectedSchool && selectedMonth) {
                var schoolSchedules = dataByMonth[selectedMonth].filter(function(item) {
                    var address = item['ì£¼ì†Œ'] || item['ì§€ì—­'] || '';
                    return item['í•™êµ'] === selectedSchool && address === selectedAddress;
                });

                var dates = new Set();
                schoolSchedules.forEach(item => dates.add(item['ì²´í—˜ì¼']));
                var uniqueDates = Array.from(dates).sort().reverse();
                
                if (uniqueDates.length > 0) {
                    dateOptions.innerHTML = '';
                    uniqueDates.forEach(function(date) {
                        var dateDiv = document.createElement('div');
                        dateDiv.className = 'date-option';
                        dateDiv.setAttribute('data-date', date);
                        dateDiv.onclick = function() { selectDate(this.getAttribute('data-date'), this); };
                        
                        var programCount = schoolSchedules.filter(item => item['ì²´í—˜ì¼'] === date).length;
                        dateDiv.innerHTML = date + '<br><small style="opacity: 0.8;">' + programCount + 'ê°œ í”„ë¡œê·¸ë¨</small>';
                        dateOptions.appendChild(dateDiv);
                    });
                    dateContainer.style.display = 'block';
                } else {
                    dateContainer.style.display = 'none';
                }
            } else {
                dateContainer.style.display = 'none';
            }
            selectedDate = null;
            checkGenerateBtn();
        }

        // ë‚ ì§œ ì„ íƒ ì´ˆê¸°í™”
        function resetDateSelection() {
            document.getElementById('dateSelectionContainer').style.display = 'none';
            selectedDate = null;
        }

        // ë‚ ì§œ ì„ íƒ
        function selectDate(date, element) {
            var dateOptions = document.querySelectorAll('.date-option');
            for (var i = 0; i < dateOptions.length; i++) {
                dateOptions[i].classList.remove('selected');
            }
            element.classList.add('selected');
            selectedDate = date;
            checkGenerateBtn();
        }

        // ìƒì„± ë²„íŠ¼ í™œì„±í™” ì²´í¬
        function checkGenerateBtn() {
            var school = document.getElementById('schoolSelect').value;
            var contact = document.getElementById('contactSelect').value;
            var canGenerate = school && selectedMonth && selectedDate && contact && isDataLoaded;
            document.getElementById('generateBtn').disabled = !canGenerate;
        }

        // íƒ­ ì „í™˜
        function switchTab(tabName) {
            var tabs = document.querySelectorAll('.tab-content');
            var buttons = document.querySelectorAll('.tab-button');
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
            }
            document.getElementById(tabName + 'Tab').classList.add('active');
            document.querySelector('.tab-button[onclick="switchTab(\'' + tabName + '\')"]').classList.add('active');
        }

        // ì—°ë½ì²˜ ê´€ë¦¬
        function addContact() {
            var position = document.getElementById('contactPosition').value.trim();
            var name = document.getElementById('contactName').value.trim();
            var phone = document.getElementById('contactPhone').value.trim();
            if (!position || !name || !phone) {
                alert('ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            var info = position + ' ' + name + ' (' + phone + ')';
            contacts.push({ position: position, name: name, phone: phone, info: info });
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            localStorage.setItem('contacts', JSON.stringify(contacts));
            
            updateContactList();
            updateContactSelect();
            clearContactForm();
            alert('ë‹´ë‹¹ìê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function updateContactList() {
            var list = document.getElementById('contactList');
            if (contacts.length === 0) {
                list.innerHTML = '<p style="color:#666;">ë“±ë¡ëœ ë‹´ë‹¹ìê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            var html = '';
            for (var i = 0; i < contacts.length; i++) {
                var c = contacts[i];
                html += '<div class="contact-item">' +
                       '<span>' + c.info + '</span>' +
                       '<button class="delete-btn" onclick="deleteContact(' + i + ')">ì‚­ì œ</button>' +
                       '</div>';
            }
            list.innerHTML = html;
        }

        function updateContactSelect() {
            var select = document.getElementById('contactSelect');
            var html = '<option value="">ë‹´ë‹¹ìë¥¼ ì„ íƒí•˜ì„¸ìš”...</option>';
            for (var i = 0; i < contacts.length; i++) {
                var c = contacts[i];
                html += '<option value="' + c.info + '">' + c.info + '</option>';
            }
            select.innerHTML = html;
            checkGenerateBtn();
        }

        function deleteContact(idx) {
            if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                contacts.splice(idx, 1);
                localStorage.setItem('contacts', JSON.stringify(contacts));
                updateContactList();
                updateContactSelect();
            }
        }

        function clearContactForm() {
            document.getElementById('contactPosition').value = '';
            document.getElementById('contactName').value = '';
            document.getElementById('contactPhone').value = '';
        }

        // ê³„íšì„œ ìƒì„±
        function generatePlan() {
            var selectedValue = document.getElementById('schoolSelect').value;
            if (!selectedValue) {
                alert('í•™êµë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            var [schoolName, schoolAddress] = selectedValue.split('___');
            
            var contactInfo = document.getElementById('contactSelect').value;
            var locationAssignment = document.querySelector('input[name="locationAssignment"]:checked').value;
            if (!schoolName || !selectedMonth || !selectedDate || !contactInfo) {
                alert('ëª¨ë“  ì •ë³´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            document.getElementById('loading').style.display = 'block';
            document.getElementById('planResult').innerHTML = '';
            setTimeout(() => {
                displayPlan(schoolName, schoolAddress, selectedDate, contactInfo, locationAssignment);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('planResult').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 2000);
        }

        // ê³„íšì„œ í‘œì‹œ
        function displayPlan(schoolName, schoolAddress, selectedDate, contactInfo, locationAssignment) {
            var resultDiv = document.getElementById('planResult');
            var schoolSchedules = dataByMonth[selectedMonth].filter(function(item) {
                var address = item['ì£¼ì†Œ'] || item['ì§€ì—­'] || '';
                return item['ì²´í—˜ì¼'] === selectedDate && item['í•™êµ'] === schoolName && address === schoolAddress;
            });
            if (schoolSchedules.length === 0) {
                resultDiv.innerHTML = '<div class="error-message">' +
                    'ì„ íƒëœ ë‚ ì§œ(' + selectedDate + ')ì™€ í•™êµ(' + schoolName + ')ì— ëŒ€í•œ êµìœ¡ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.' +
                    '</div>';
                return;
            }
            var timeRange = schoolSchedules[0]['ìˆ˜ì—…ì‹œê°„'] || '09:00 ~ 12:30';
            var totalClasses = parseInt(schoolSchedules[0]['ì°¨ì‹œ']) || 4;
            var schoolType = schoolName.includes('ê³ ë“±í•™êµ') ? 'high' : 
                            schoolName.includes('ì¤‘í•™êµ') ? 'middle' : 'elementary';

            var programs = [];
            for (var i = 0; i < schoolSchedules.length; i++) {
                var item = schoolSchedules[i];
                var location = locationAssignment === 'pre' ? (item['í•™ë…„'] || 'ì „ì²´') : 'í˜„ì¥ ë°°ì •';
                
                if (location !== 'í˜„ì¥ ë°°ì •' && location !== 'ì „ì²´') {
                    if (/^\d+$/.test(location)) {
                        location = location + 'í•™ë…„';
                    } else if (!location.includes('í•™ë…„')) {
                        location = location + 'í•™ë…„';
                    }
                }
                
                programs.push({
                    name: item['ìˆ˜ì—…'] || 'ë¯¸ì •',
                    instructor: item['ê°•ì‚¬ì´ë¦„'] || 'ë¯¸ì •',
                    location: location
                });
            }

            var schedule = generateScheduleFromTime(timeRange, totalClasses, schoolType);
            planData = {
                school: {
                    name: schoolName,
                    date: selectedDate,
                    location: schoolAddress || schoolSchedules[0]['ì§€ì—­'] || 'ìœ„ì¹˜ ë¯¸ì •',
                    totalClasses: schoolSchedules[0]['ì°¨ì‹œ'] || 'ë¯¸ì •',
                    time: timeRange,
                    contact: contactInfo
                },
                programs: programs,
                schedule: schedule,
                locationAssignment: locationAssignment,
                schoolSchedules: schoolSchedules
            };
            renderPlan();
            
            // êµí†µë¹„ ê³„ì‚° ìë™ ì‹¤í–‰
            setTimeout(() => {
                calculateTransportCost();
            }, 1000);
        }

        // ê³„íšì„œ ë Œë”ë§
        function renderPlan() {
            var resultDiv = document.getElementById('planResult');
            var schoolNameWithLocation = planData.school.name;
            if (planData.school.location && planData.school.location !== 'ìœ„ì¹˜ ë¯¸ì •') {
                schoolNameWithLocation += ' (' + planData.school.location + ')';
            }
            
            var grade = '';
            var studentCount = '';
            
            if (planData.programs && planData.programs.length > 0) {
                var firstLocation = planData.programs[0].location;
                if (/^\d+$/.test(firstLocation)) {
                    grade = firstLocation + 'í•™ë…„';
                } else if (firstLocation.includes('í•™ë…„')) {
                    grade = firstLocation.replace(/(í•™ë…„)+/, 'í•™ë…„');
                } else {
                    grade = firstLocation;
                }

                var studentCounts = planData.schoolSchedules
                    .map(item => item['ë°˜ì¸ì›ìˆ˜'])
                    .filter(count => count && !isNaN(parseInt(count)))
                    .map(count => parseInt(count));

                if (studentCounts.length > 0) {
                    var avgCount = Math.round(studentCounts.reduce((a, b) => a + b, 0) / studentCounts.length);
                    studentCount = ' (ì•½ ë°˜ë‹¹ ' + avgCount + 'ëª…)';
                }
            } else {
                grade = 'í•™ë…„';
            }
            
            var html = '<div class="education-plan">' +
                '<div class="decoration-circle decoration-circle-1"></div>' +
                '<div class="decoration-circle decoration-circle-2"></div>' +
                '<div class="plan-content">' +
                '<div class="plan-title trendy">' +
                '    <span class="brand-mark">DREAMPLEX</span>' +
                '    <h1>' + planData.school.name + '</h1>' +
                '    <h2>êµìœ¡ê³„íšì„œ</h2>' +
                '</div>' +
                
                '<div class="section">' +
                '<div class="section-title">ê¸°ë³¸ì‚¬í•­</div>' +
                '<div class="basic-info">' +
                '<div class="info-row">' +
                '<div class="info-label">ì¥ì†Œ</div>' +
                '<div class="info-content" contenteditable="true">' + schoolNameWithLocation + '</div>' +
                '</div>' +
                '<div class="info-row">' +
                '<div class="info-label">ì¼ì‹œ</div>' +
                '<div class="info-content" contenteditable="true">' + planData.school.date + '</div>' +
                '</div>' +
                '<div class="info-row">' +
                '<div class="info-label">ëŒ€ìƒ</div>' +
                '<div class="info-content" contenteditable="true">' + grade + studentCount + '</div>' +
                '</div>' +
                '<div class="info-row">' +
                '<div class="info-label">ì‹œê°„</div>' +
                '<div class="info-content" contenteditable="true">' + planData.school.time + '</div>' +
                '</div>' +
                '<div class="info-row">' +
                '<div class="info-label">ìœ„ì¹˜</div>' +
                '<div class="info-content" contenteditable="true">ë³¸ê´€ í˜„ê´€ (ë¯¸ë¦¬ ë„ì°©í•œ ê²½ìš° ì°¨ì—ì„œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.)</div>' +
                '</div>' +
                '<div class="info-row">' +
                '<div class="info-label">ë‹´ë‹¹ì</div>' +
                '<div class="info-content" contenteditable="true">' + planData.school.contact + '</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                
                '<div class="section">' +
                '<div class="section-title">í”„ë¡œê·¸ë¨</div>' +
                '<div class="program-grid">';

            // AIêµìœ¡ ì—¬ë¶€ í™•ì¸
            var isAIEducation = planData.programs.some(program => 
                program.name.includes('AIë¯¸ë˜í•™êµ') || 
                program.name.includes('AIê¸°ì—…ê°€ì •ì‹ ') || 
                program.name.includes('ê¸°ì—…ê°€ì •ì‹ ')
            );

            var totalClasses = parseInt(planData.school.totalClasses) || 4;

            // í…Œì´ë¸” í´ë˜ìŠ¤ ì„¤ì •
            if (isAIEducation || totalClasses === 2) {
                html = html.replace('class="program-grid">', 'class="program-grid table-3cols">');
            } else if (totalClasses === 4) {
                html = html.replace('class="program-grid">', 'class="program-grid table-4cols">');
            } else if (totalClasses === 6) {
                html = html.replace('class="program-grid">', 'class="program-grid table-5cols">');
            }

            // í…Œì´ë¸” í—¤ë” ìƒì„±
            if (isAIEducation || totalClasses === 2) {
                html += '<div class="program-header">' +
                    '<div>í”„ë¡œê·¸ë¨</div>' +
                    '<div>ê°•ì‚¬</div>' +
                    '<div>ìœ„ì¹˜</div>' +
                    '</div>';
            } else if (totalClasses === 4) {
                html += '<div class="program-header">' +
                    '<div>í”„ë¡œê·¸ë¨</div>' +
                    '<div>ê°•ì‚¬</div>' +
                    '<div>1-2ì°¨ì‹œ</div>' +
                    '<div>3-4ì°¨ì‹œ</div>' +
                    '</div>';
            } else if (totalClasses === 6) {
                html += '<div class="program-header">' +
                    '<div>í”„ë¡œê·¸ë¨</div>' +
                    '<div>ê°•ì‚¬</div>' +
                    '<div>1-2ì°¨ì‹œ</div>' +
                    '<div>3-4ì°¨ì‹œ</div>' +
                    '<div>5-6ì°¨ì‹œ</div>' +
                    '</div>';
            }

            // í”„ë¡œê·¸ë¨ í–‰ ìƒì„±
            for (var i = 0; i < planData.programs.length; i++) {
                var program = planData.programs[i];
                html += '<div class="program-row">' +
                    '<div class="program-cell" contenteditable="true">' + program.name + '</div>' +
                    '<div class="program-cell" contenteditable="true">' + program.instructor + '</div>';

                if (isAIEducation || totalClasses === 2) {
                    html += '<div class="program-cell" contenteditable="true">' + 
                        (program.location || '') + '</div>';
                } else if (totalClasses === 4) {
                    html += '<div class="program-cell" contenteditable="true">' + 
                        (program.location || '') + '</div>' +
                        '<div class="program-cell" contenteditable="true">' + 
                        (program['3-4ì°¨ì‹œìœ„ì¹˜'] || '') + '</div>';
                } else if (totalClasses === 6) {
                    html += '<div class="program-cell" contenteditable="true">' + 
                        (program.location || '') + '</div>' +
                        '<div class="program-cell" contenteditable="true">' + 
                        (program['3-4ì°¨ì‹œìœ„ì¹˜'] || '') + '</div>' +
                        '<div class="program-cell" contenteditable="true">' + 
                        (program['5-6ì°¨ì‹œìœ„ì¹˜'] || '') + '</div>';
                }

                html += '</div>';
            }

            // ì§„ë¡œì²´í—˜ì˜ ê²½ìš° í”„ë¡œê·¸ë¨ ìˆ˜ ì²´í¬
            if (!isAIEducation) {
                var expectedPrograms = Math.ceil(totalClasses / 2);
                if (planData.programs.length < expectedPrograms) {
                    for (var i = planData.programs.length; i < expectedPrograms; i++) {
                        html += '<div class="program-row" style="background-color: #ffebee;">' +
                            '<div class="program-cell" contenteditable="true">ë¹ˆì¹¸ì˜¤ë¥˜</div>' +
                            '<div class="program-cell" contenteditable="true"></div>';
                        
                        if (totalClasses === 4) {
                            html += '<div class="program-cell" contenteditable="true"></div>' +
                                '<div class="program-cell" contenteditable="true"></div>';
                        } else if (totalClasses === 6) {
                            html += '<div class="program-cell" contenteditable="true"></div>' +
                                '<div class="program-cell" contenteditable="true"></div>' +
                                '<div class="program-cell" contenteditable="true"></div>';
                        } else {
                            html += '<div class="program-cell" contenteditable="true"></div>';
                        }
                        
                        html += '</div>';
                    }
                }
            }

            html += '</div>' +
                '<div class="note-box">í”„ë¡œê·¸ë¨ê³¼ êµì‹¤ì„ í™•ì¸í•´ì£¼ì„¸ìš”.<br>â€» í•™êµì¸¡ì—ì„œ ë°°ì •í•œ êµì‹¤ë¡œ ë‹¹ì¼ ìˆ˜ì—… ì´ë™ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.</div>' +
                '</div>';
            
            // ì‹œê°„í‘œ ì„¹ì…˜ ì¶”ê°€
            html += '<div class="section">' +
                '<div class="section-title">ì‹œê°„í‘œ</div>' +
                '<div class="schedule-grid">' +
                '<div class="schedule-header">' +
                '<div>ì‹œê°„</div>' +
                '<div>ë‚´ìš©</div>' +
                '</div>';

            for (var i = 0; i < planData.schedule.length; i++) {
                var item = planData.schedule[i];
                html += '<div class="schedule-row">' +
                    '<div class="schedule-cell">' + item.time + '</div>' +
                    '<div class="schedule-cell" contenteditable="true">' + item.content + '</div>' +
                    '</div>';
            }

            html += '</div>' +
                '<div class="note-box">ì¼ì •ì„ í™•ì¸ í•´ì£¼ì„¸ìš”.<br>â€»ì‹œê°„ì€ í˜„ì¥ ìƒí™©ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>' +
                '</div>' +
                '</div>' +
                '</div>' +
                
                '<div class="download-section">' +
                '<button class="save-btn" onclick="saveEdits()">ğŸ’¾ ë³€ê²½ì‚¬í•­ ì €ì¥</button>' +
                '<button class="download-btn" onclick="downloadAsImage()">ğŸ–¼ï¸ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ</button>' +
                '<button class="download-btn" onclick="generatePDF()">ğŸ“„ PDF ë‹¤ìš´ë¡œë“œ</button>' +
                '</div>';
            
            resultDiv.innerHTML = html;
        }

        // ì‹œê°„í‘œ ìƒì„±
        function generateScheduleFromTime(timeRange, totalClasses, schoolType) {
            var schedule = [];
            var timeParts = timeRange.split(' ~ ');
            if (timeParts.length !== 2) {
                return [
                    { time: '8:20', content: 'í•™êµ ë„ì°©' },
                    { time: '8:50 ~ 9:35', content: 'ì§„ë¡œì²´í—˜ ë° ì§„ë¡œêµìœ¡ (1)' },
                    { time: '9:35 ~ 9:45', content: 'ì‰¬ëŠ” ì‹œê°„' },
                    { time: '9:45 ~ 10:30', content: 'ì§„ë¡œì²´í—˜ ë° ì§„ë¡œêµìœ¡ (2)' },
                    { time: '10:30 ~ 10:40', content: 'ì‰¬ëŠ” ì‹œê°„' },
                    { time: '10:40 ~ 11:25', content: 'ì§„ë¡œì²´í—˜ ë° ì§„ë¡œêµìœ¡ (3)' },
                    { time: '11:25 ~ 11:35', content: 'ì‰¬ëŠ” ì‹œê°„' },
                    { time: '11:35 ~ 12:20', content: 'ì§„ë¡œì²´í—˜ ë° ì§„ë¡œêµìœ¡ (4)' },
                    { time: '12:20 ~', content: 'í–‰ì‚¬ ì¢…ë£Œ' }
                ];
            }
            
            var startTime = timeParts[0].trim();
            var startParts = startTime.split(':');
            var startHour = parseInt(startParts[0]);
            var startMinute = parseInt(startParts[1]);

            var arrivalHour = startHour;
            var arrivalMinute = startMinute - 30;
            if (arrivalMinute < 0) {
                arrivalHour -= 1;
                arrivalMinute += 60;
            }
            schedule.push({
                time: formatTimeSimple(arrivalHour, arrivalMinute),
                content: 'í•™êµ ë„ì°©'
            });

            var currentHour = startHour;
            var currentMinute = startMinute;
            var lessonDuration = (schoolType === 'high') ? 50 : 
                               (schoolType === 'middle') ? 45 : 40;
            var breakDuration = 10;
            var lunchDuration = 45;
            var lessonCount = totalClasses;

            for (var i = 0; i < lessonCount; i++) {
                var lessonStartHour = currentHour;
                var lessonStartMinute = currentMinute;
                var lessonEndHour = lessonStartHour;
                var lessonEndMinute = lessonStartMinute + lessonDuration;
                if (lessonEndMinute >= 60) {
                    lessonEndHour += 1;
                    lessonEndMinute -= 60;
                }
                schedule.push({
                    time: formatTimeSimple(lessonStartHour, lessonStartMinute) + ' ~ ' + formatTimeSimple(lessonEndHour, lessonEndMinute),
                    content: 'ì§„ë¡œì²´í—˜ ë° ì§„ë¡œêµìœ¡ (' + (i + 1) + ')'
                });

                if (lessonCount === 6 && i === 3) {
                    var lunchStartHour = lessonEndHour;
                    var lunchStartMinute = lessonEndMinute;
                    var lunchEndHour = lunchStartHour;
                    var lunchEndMinute = lunchStartMinute + lunchDuration;
                    if (lunchEndMinute >= 60) {
                        lunchEndHour += 1;
                        lunchEndMinute -= 60;
                    }
                    schedule.push({
                        time: formatTimeSimple(lunchStartHour, lunchStartMinute) + ' ~ ' + formatTimeSimple(lunchEndHour, lunchEndMinute),
                        content: 'ì ì‹¬ì‹œê°„'
                    });
                    currentHour = lunchEndHour;
                    currentMinute = lunchEndMinute;
                    continue;
                }

                if (i < lessonCount - 1) {
                    var breakEndHour = lessonEndHour;
                    var breakEndMinute = lessonEndMinute + breakDuration;
                    if (breakEndMinute >= 60) {
                        breakEndHour += 1;
                        breakEndMinute -= 60;
                    }
                    schedule.push({
                        time: formatTimeSimple(lessonEndHour, lessonEndMinute) + ' ~ ' + formatTimeSimple(breakEndHour, breakEndMinute),
                        content: 'ì‰¬ëŠ” ì‹œê°„'
                    });
                    currentHour = breakEndHour;
                    currentMinute = breakEndMinute;
                } else {
                    currentHour = lessonEndHour;
                    currentMinute = lessonEndMinute;
                }
            }

            schedule.push({
                time: formatTimeSimple(currentHour, currentMinute) + ' ~',
                content: 'í–‰ì‚¬ ì¢…ë£Œ'
            });

            return schedule;
        }

        function formatTimeSimple(hour, minute) {
            return hour + ':' + (minute < 10 ? '0' + minute : minute);
        }

        // í¸ì§‘ ì €ì¥
        function saveEdits() {
            var infoCells = document.querySelectorAll('.info-content[contenteditable="true"]');
            planData.school.name = infoCells[0].textContent;
            planData.school.date = infoCells[1].textContent;
            planData.school.target = infoCells[2].textContent;
            planData.school.time = infoCells[3].textContent;
            planData.school.location = infoCells[4].textContent;
            planData.school.contact = infoCells[5].textContent;

            var programCells = document.querySelectorAll('.program-cell[contenteditable="true"]');
            planData.programs = [];
            for (var i = 0; i < programCells.length; i += 3) {
                planData.programs.push({
                    name: programCells[i].textContent,
                    instructor: programCells[i + 1].textContent,
                    location: programCells[i + 2].textContent
                });
            }

            var scheduleCells = document.querySelectorAll('.schedule-cell[contenteditable="true"]');
            planData.schedule = [];
            for (var i = 0; i < scheduleCells.length; i += 2) {
                planData.schedule.push({
                    time: scheduleCells[i].textContent,
                    content: scheduleCells[i + 1].textContent
                });
            }

            alert('ë³€ê²½ì‚¬í•­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
        function downloadAsImage() {
            var planResult = document.querySelector('.education-plan');
            
            var loadingDiv = document.createElement('div');
            loadingDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0,0,0,0.8);
                color: white;
                padding: 20px 40px;
                border-radius: 10px;
                z-index: 10000;
                font-size: 16px;
            `;
            loadingDiv.textContent = 'ê³ í•´ìƒë„ ì´ë¯¸ì§€ ìƒì„± ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.';
            document.body.appendChild(loadingDiv);
            
            setTimeout(() => {
                var scale = 2;
                var width = planResult.offsetWidth * scale;
                var height = planResult.offsetHeight * scale;
                
                domtoimage.toBlob(planResult, {
                    quality: 1.0,
                    bgcolor: '#ffffff',
                    width: width,
                    height: height,
                    style: {
                        'transform': 'scale(' + scale + ')',
                        'transform-origin': 'top left',
                        'width': planResult.offsetWidth + 'px',
                        'height': planResult.offsetHeight + 'px'
                    },
                    filter: function(node) {
                        return !(node instanceof HTMLImageElement && node.src.startsWith('data:'));
                    }
                })
                .then(function(blob) {
                    var link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = selectedDate.replace(/\./g, '') + '_' + document.getElementById('schoolSelect').value + '_êµìœ¡ê³„íšì„œ_HD.png';
                    link.click();
                    
                    document.body.removeChild(loadingDiv);
                })
                .catch(function(error) {
                    console.error('ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨:', error);
                    alert('ì´ë¯¸ì§€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    
                    document.body.removeChild(loadingDiv);
                });
            }, 3000);
        }

        // PDF ìƒì„±
        function generatePDF() {
            if (!planData) {
                alert('ê³„íšì„œê°€ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë¨¼ì € ê³„íšì„œë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.');
                return;
            }
            alert('PDF ìƒì„± ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤. ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œë¥¼ ì´ìš©í•´ì£¼ì„¸ìš”.');
        }

        // ========== êµí†µë¹„ ê³„ì‚° ê´€ë ¨ í•¨ìˆ˜ë“¤ ==========

        // êµí†µë¹„ ê³„ì‚° ë©”ì¸ í•¨ìˆ˜ (ë„¤ì´ë²„ API ì „ìš©)
        function calculateTransportCost() {
            if (!planData || !planData.school) {
                showNoRouteData();
                return;
            }

            console.log('=== êµí†µë¹„ ê³„ì‚° ì‹œì‘ (ë„¤ì´ë²„ API ì „ìš©) ===');
            console.log('ëª©ì ì§€:', planData.school.name + ' ' + (planData.school.location || ''));

            showLoadingRoute();
            
            var requestData = {
                action: 'getRoute',
                origin: 'ëŒ€êµ¬ ë¶êµ¬ íƒœí‰ë¡œ 161',
                destination: planData.school.name + ' ' + (planData.school.location || '')
            };

            console.log('ìš”ì²­ ë°ì´í„°:', requestData);

            // GAS URLì´ ì„¤ì •ë˜ì–´ ìˆì–´ì•¼ë§Œ ì‘ë™
            if (!GAS_URL || GAS_URL.includes('YOUR_SCRIPT_ID')) {
                hideLoadingRoute();
                showAPIRequiredMessage();
                return;
            }

            callGoogleAppsScript(requestData)
                .then(response => {
                    console.log('API ì‘ë‹µ:', response);
                    if (response && response.status === 'success') {
                        console.log('âœ… ë„¤ì´ë²„ API êµí†µë¹„ ê³„ì‚° ì„±ê³µ');
                        processRouteData(response.data);
                    } else {
                        throw new Error(response.message || 'API ì‘ë‹µ ì‹¤íŒ¨');
                    }
                })
                .catch(error => {
                    hideLoadingRoute();
                    console.error('âŒ ë„¤ì´ë²„ API í˜¸ì¶œ ì‹¤íŒ¨:', error);
                    showAPIErrorMessage(error.message);
                });
        }

        // API í•„ìˆ˜ ë©”ì‹œì§€ í‘œì‹œ
        function showAPIRequiredMessage() {
            document.getElementById('routeCalculation').style.display = 'none';
            document.getElementById('loadingRoute').style.display = 'none';
            
            var noRouteDiv = document.getElementById('noRouteData');
            noRouteDiv.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #d32f2f;">
                    <h3 style="color: #d32f2f; margin-bottom: 20px;">âš ï¸ Google Apps Script URL ì„¤ì • í•„ìš”</h3>
                    <p style="margin-bottom: 15px;">ì •í™•í•œ í†µí–‰ë£Œì™€ ì—°ë£Œë¹„ ê³„ì‚°ì„ ìœ„í•´ì„œëŠ”</p>
                    <p style="margin-bottom: 15px;"><strong>Google Apps Script URL ì„¤ì •ì´ í•„ìˆ˜</strong>ì…ë‹ˆë‹¤.</p>
                    <div style="background: #ffebee; border-radius: 8px; padding: 20px; margin: 20px 0; text-align: left;">
                        <h4 style="margin-top: 0; color: #d32f2f;">ğŸš« ì¶”ì • ê³„ì‚° ê¸°ëŠ¥ ì œê±°ë¨</h4>
                        <p>â€¢ ë„¤ì´ë²„ ì§€ë„ APIì—ì„œ ì§ì ‘ ì œê³µí•˜ëŠ” ì •í™•í•œ ë°ì´í„°ë§Œ ì‚¬ìš©</p>
                        <p>â€¢ ì¶”ì •ì¹˜ë¡œ ì¸í•œ ì˜¤ë¥˜ ë°©ì§€ë¥¼ ìœ„í•´ ê¸°ë³¸ ê³„ì‚° ê¸°ëŠ¥ ì œê±°</p>
                        <p>â€¢ ë°˜ë“œì‹œ Google Apps Script ì„¤ì • í›„ ì‚¬ìš© ê°€ëŠ¥</p>
                    </div>
                    <button class="kakao-share-btn" onclick="showGoogleAppsScriptGuide()" 
                            style="background: linear-gradient(135deg, #17a2b8 0%, #6f42c1 100%); color: white; margin: 10px;">
                        ğŸ”§ GAS ì„¤ì • ê°€ì´ë“œ ë³´ê¸°
                    </button>
                </div>
            `;
            noRouteDiv.style.display = 'block';
        }

        // API ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
        function showAPIErrorMessage(errorMessage) {
            document.getElementById('routeCalculation').style.display = 'none';
            document.getElementById('loadingRoute').style.display = 'none';
            
            var noRouteDiv = document.getElementById('noRouteData');
            noRouteDiv.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #d32f2f;">
                    <h3 style="color: #d32f2f; margin-bottom: 20px;">âŒ ë„¤ì´ë²„ API í˜¸ì¶œ ì‹¤íŒ¨</h3>
                    <div style="background: #ffebee; border-radius: 8px; padding: 20px; margin: 20px 0; text-align: left;">
                        <h4 style="margin-top: 0; color: #d32f2f;">ì˜¤ë¥˜ ë‚´ìš©:</h4>
                        <p style="font-family: monospace; background: white; padding: 10px; border-radius: 4px;">
                            ${errorMessage}
                        </p>
                    </div>
                    <div style="background: #fff3cd; border-radius: 8px; padding: 15px; margin: 15px 0; text-align: left;">
                        <h4 style="margin-top: 0; color: #856404;">ğŸ’¡ í•´ê²° ë°©ë²•:</h4>
                        <p>1. Google Apps Script URLì´ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸</p>
                        <p>2. ë„¤ì´ë²„ API í‚¤ê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸</p>
                        <p>3. ëª©ì ì§€ ì£¼ì†Œê°€ ì •í™•í•œì§€ í™•ì¸</p>
                    </div>
                    <div style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
                        <button class="kakao-share-btn" onclick="testAPIConnection()" 
                                style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white;">
                            ğŸ”„ API ì—°ê²° í…ŒìŠ¤íŠ¸
                        </button>
                        <button class="kakao-share-btn" onclick="showGoogleAppsScriptGuide()" 
                                style="background: linear-gradient(135deg, #17a2b8 0%, #6f42c1 100%); color: white;">
                            ğŸ”§ ì„¤ì • ê°€ì´ë“œ
                        </button>
                    </div>
                </div>
            `;
            noRouteDiv.style.display = 'block';
        }

        // ì‹œë®¬ë ˆì´ì…˜ ê´€ë ¨ í•¨ìˆ˜ë“¤ ì œê±°
        // simulateRouteCalculation í•¨ìˆ˜ ì œê±°
        // estimateDistanceFromDestination í•¨ìˆ˜ ì œê±°
        // calculateBasicTollFee í•¨ìˆ˜ ì œê±°
        // calculateBasicFuelCost í•¨ìˆ˜ ì œê±°

        // Google Apps Script í˜¸ì¶œ
        function callGoogleAppsScript(requestData) {
            console.log('=== Google Apps Script í˜¸ì¶œ ===');
            console.log('URL:', GAS_URL);
            console.log('ìš”ì²­:', requestData);
            
            if (!GAS_URL || GAS_URL.includes('YOUR_SCRIPT_ID')) {
                console.log('âŒ GAS URLì´ ì„¤ì •ë˜ì§€ ì•ŠìŒ');
                return Promise.resolve(null);
            }
            
            if (!GAS_URL.startsWith('https://script.google.com/')) {
                console.log('âŒ ì˜ëª»ëœ GAS URL í˜•ì‹');
                return Promise.resolve(null);
            }
            
            return fetch(GAS_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestData)
            })
            .then(response => {
                console.log('ğŸ“¡ ì‘ë‹µ ìƒíƒœ:', response.status);
                if (!response.ok) {
                    throw new Error('HTTP error: ' + response.status);
                }
                return response.json();
            })
            .then(data => {
                console.log('âœ… ì‘ë‹µ ë°ì´í„°:', data);
                return data;
            })
            .catch(error => {
                console.error('âŒ í˜¸ì¶œ ì‹¤íŒ¨:', error);
                throw error;
            });
        }

        // ê²½ë¡œ ë°ì´í„° ì²˜ë¦¬
        function processRouteData(data) {
            console.log('=== ê²½ë¡œ ë°ì´í„° ì²˜ë¦¬ ===');
            console.log('ì…ë ¥ ë°ì´í„°:', data);
            
            transportData = {
                distance: data.distance || 0,
                duration: data.duration || 0,
                tollFare: data.tollFare || 0,
                fuelPrice: data.fuelPrice || 0,
                totalCost: 0,
                source: data.source || { tollFare: 'calculated', fuelPrice: 'calculated' }
            };

            console.log('ì²˜ë¦¬ëœ êµí†µ ë°ì´í„°:', transportData);
            
            updateTransportDisplay();
            hideLoadingRoute();
        }

        // êµí†µë¹„ í‘œì‹œ ì—…ë°ì´íŠ¸ (ë„¤ì´ë²„ API ì „ìš©)
        function updateTransportDisplay() {
            console.log('=== êµí†µë¹„ í‘œì‹œ ì—…ë°ì´íŠ¸ (ë„¤ì´ë²„ API ì „ìš©) ===');
            
            var roundTripDistance = transportData.distance * 2;
            console.log('ì™•ë³µ ê±°ë¦¬:', roundTripDistance, 'km');

            // ë„¤ì´ë²„ APIì—ì„œ ì œê³µë°›ì€ ë°ì´í„°ë§Œ ì‚¬ìš© (ì™•ë³µ ê³„ì‚°)
            var fuelCost = transportData.fuelPrice * 2; // ì™•ë³µ ì—°ë£Œë¹„
            var roundTripTollFee = transportData.tollFare * 2; // ì™•ë³µ í†µí–‰ë£Œ
            var totalCost = fuelCost + roundTripTollFee;

            console.log('ë„¤ì´ë²„ API ë°ì´í„°:');
            console.log('- í¸ë„ ì—°ë£Œë¹„:', transportData.fuelPrice, 'ì›');
            console.log('- í¸ë„ í†µí–‰ë£Œ:', transportData.tollFare, 'ì›');
            console.log('- ì™•ë³µ ì—°ë£Œë¹„:', fuelCost, 'ì›');
            console.log('- ì™•ë³µ í†µí–‰ë£Œ:', roundTripTollFee, 'ì›');
            console.log('- ì´ êµí†µë¹„:', totalCost, 'ì›');

            transportData.fuelCost = fuelCost;
            transportData.totalCost = totalCost;

            // ë°ì´í„° ì†ŒìŠ¤ í‘œì‹œ
            var fuelSource = 'ë„¤ì´ë²„ API (' + transportData.source.fuelPrice + ')';
            var tollSource = 'ë„¤ì´ë²„ API (' + transportData.source.tollFare + ')';

            // í™”ë©´ ì—…ë°ì´íŠ¸
            document.getElementById('destinationSchool').textContent = planData.school.name;
            document.getElementById('totalDistance').textContent = roundTripDistance + 'km';
            document.getElementById('estimatedTime').textContent = Math.floor(transportData.duration * 2 / 60) + 'ì‹œê°„ ' + (transportData.duration * 2 % 60) + 'ë¶„';
            
            document.getElementById('fuelCost').textContent = fuelCost.toLocaleString() + 'ì› (' + fuelSource + ')';
            document.getElementById('tollCost').textContent = roundTripTollFee.toLocaleString() + 'ì› (' + tollSource + ')';
            document.getElementById('totalCost').textContent = totalCost.toLocaleString() + 'ì›';

            // ì¹´í’€ë¹„ ê³„ì‚°
            document.getElementById('carpool2').textContent = Math.round(totalCost / 2).toLocaleString() + 'ì›';
            document.getElementById('carpool3').textContent = Math.round(totalCost / 3).toLocaleString() + 'ì›';
            document.getElementById('carpool4').textContent = Math.round(totalCost / 4).toLocaleString() + 'ì›';

            showRouteCalculation();
        }

        // ì¹´ì¹´ì˜¤í†¡ í…ìŠ¤íŠ¸ ë³µì‚¬
        function copyKakaoText() {
            if (!transportData || transportData.totalCost === 0) {
                alert('ë¨¼ì € êµí†µë¹„ë¥¼ ê³„ì‚°í•´ì£¼ì„¸ìš”.');
                return;
            }

            var kakaoText = generateKakaoText();
            
            navigator.clipboard.writeText(kakaoText).then(() => {
                alert('âœ… ì¹´ì¹´ì˜¤í†¡ìš© í…ìŠ¤íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }).catch(() => {
                var textArea = document.createElement('textarea');
                textArea.value = kakaoText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('âœ… ì¹´ì¹´ì˜¤í†¡ìš© í…ìŠ¤íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }

        // ì¹´ì¹´ì˜¤í†¡ í…ìŠ¤íŠ¸ ìƒì„±
        function generateKakaoText() {
            var text = '';
            text += 'ğŸš—ğŸ’° DREAMPLEX ì¹´í’€ë¹„ ì•ˆë‚´\n';
            text += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';
            text += `ğŸ“ ${planData.school.name} (${planData.school.date})\n`;
            text += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';
            text += `â›½ ì™•ë³µ ì—°ë£Œë¹„: ${transportData.fuelCost.toLocaleString()}ì›\n`;
            text += `ğŸ›£ï¸ ì™•ë³µ í†µí–‰ë£Œ: ${(transportData.tollFare * 2).toLocaleString()}ì›\n`;
            text += `ğŸ’° ì´ êµí†µë¹„: ${transportData.totalCost.toLocaleString()}ì›\n`;
            text += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';
            text += 'ğŸ‘¥ íƒ‘ìŠ¹ìë³„ ë¶€ë‹´ê¸ˆ:\n';
            text += `- 2ëª…: ${Math.round(transportData.totalCost / 2).toLocaleString()}ì›/ì¸\n`;
            text += `- 3ëª…: ${Math.round(transportData.totalCost / 3).toLocaleString()}ì›/ì¸\n`;
            text += `- 4ëª…: ${Math.round(transportData.totalCost / 4).toLocaleString()}ì›/ì¸\n`;
            text += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';
            text += 'ğŸ’¡ ìš´ì „ ìˆ˜ê³ ë¹„ í¬í•¨ ê¸ˆì•¡ì…ë‹ˆë‹¤';
            
            return text;
        }

        // UI í‘œì‹œ í•¨ìˆ˜ë“¤
        function showRouteCalculation() {
            document.getElementById('routeCalculation').style.display = 'block';
            document.getElementById('noRouteData').style.display = 'none';
        }

        function showLoadingRoute() {
            document.getElementById('loadingRoute').style.display = 'block';
            document.getElementById('routeCalculation').style.display = 'none';
            document.getElementById('noRouteData').style.display = 'none';
        }

        function hideLoadingRoute() {
            document.getElementById('loadingRoute').style.display = 'none';
        }

        function showNoRouteData() {
            document.getElementById('routeCalculation').style.display = 'none';
            document.getElementById('loadingRoute').style.display = 'none';
            document.getElementById('noRouteData').style.display = 'block';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ===');
            initializeApp();
        });

        function runSimpleNaverTest() {
            if (!GAS_URL || GAS_URL.includes('YOUR_SCRIPT_ID')) {
                alert('âš ï¸ Google Apps Script URLì„ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.');
                return;
            }

            alert('ì§€ê¸ˆë¶€í„° ë„¤ì´ë²„ ì„œë²„ì— ì§ì ‘ ì—°ê²°ì„ ì‹œë„í•©ë‹ˆë‹¤...');

            fetch(GAS_URL, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ action: 'simpleNaverTest' })
            })
            .then(response => response.json())
            .then(data => {
                console.log('ë„¤ì´ë²„ ì§ì ‘ í˜¸ì¶œ ê²°ê³¼:', data);
                
                let resultText = `ë„¤ì´ë²„ ì§ì ‘ í˜¸ì¶œ í…ŒìŠ¤íŠ¸ ê²°ê³¼\n\n`;
                resultText += `[ì„œë²„ ë©”ì‹œì§€]\n${data.message}\n\n`;
                
                if (data.data) {
                    resultText += `[ë„¤ì´ë²„ ì‘ë‹µ ì½”ë“œ]\n${data.data.responseCode}\n\n`;
                    resultText += `[ë„¤ì´ë²„ ì‘ë‹µ ë‚´ìš©]\n${data.data.responseText}`;
                }
                
                alert(resultText);
            })
            .catch(error => {
                alert('âŒ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘ ì‹¬ê°í•œ ì˜¤ë¥˜ ë°œìƒ:\n\n' + error.toString());
            });
        }

        function runCompareGeocodeTest() {
            if (!GAS_URL || GAS_URL.includes('YOUR_SCRIPT_ID')) {
                alert('âš ï¸ Google Apps Script URLì„ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.');
                return;
            }

            alert('ğŸ” ë‘ í•¨ìˆ˜ì˜ ì°¨ì´ì ì„ ë¶„ì„í•©ë‹ˆë‹¤...\n\n1. simpleNaverTest (ì„±ê³µí•˜ëŠ” í•¨ìˆ˜)\n2. geocodeAddress (í•˜ì´ë¸Œë¦¬ë“œ í•¨ìˆ˜)\n\nê°™ì€ API í‚¤ì™€ ì£¼ì†Œë¡œ í…ŒìŠ¤íŠ¸í•´ë³´ê² ìŠµë‹ˆë‹¤.');

            fetch(GAS_URL, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ action: 'compareGeocodeTest' })
            })
            .then(response => response.json())
            .then(data => {
                console.log('í•¨ìˆ˜ ë¹„êµ í…ŒìŠ¤íŠ¸ ê²°ê³¼:', data);
                
                let resultText = `ğŸ” í•¨ìˆ˜ ë¹„êµ í…ŒìŠ¤íŠ¸ ê²°ê³¼\n\n`;
                resultText += `[ì „ì²´ ìƒíƒœ]\n${data.status}\n\n`;
                resultText += `[ë©”ì‹œì§€]\n${data.message}\n\n`;
                
                if (data.data) {
                    if (data.data.simple) {
                        resultText += `[Simple í•¨ìˆ˜ ê²°ê³¼]\n`;
                        resultText += `ìƒíƒœ: ${data.data.simple.status}\n`;
                        if (data.data.simple.data) {
                            resultText += `ì‘ë‹µ ì½”ë“œ: ${data.data.simple.data.responseCode}\n`;
                            resultText += `ì‘ë‹µ ë‚´ìš©: ${data.data.simple.data.responseText.substring(0, 200)}...\n\n`;
                        }
                    }
                    
                    if (data.data.geocode) {
                        resultText += `[í•˜ì´ë¸Œë¦¬ë“œ Geocode í•¨ìˆ˜ ê²°ê³¼]\n`;
                        resultText += `ìœ„ë„: ${data.data.geocode.lat}\n`;
                        resultText += `ê²½ë„: ${data.data.geocode.lng}\n`;
                        resultText += `í•œê¸€ ì£¼ì†Œ: ${data.data.geocode.formattedAddress || 'N/A'}\n`;
                        resultText += `ì†ŒìŠ¤: ${data.data.geocode.source || 'N/A'}\n\n`;
                    }
                    
                    if (data.data.geocodeError) {
                        resultText += `[í•˜ì´ë¸Œë¦¬ë“œ Geocode í•¨ìˆ˜ ì˜¤ë¥˜]\n`;
                        resultText += `${data.data.geocodeError}\n\n`;
                    }
                }
                
                alert(resultText);
            })
            .catch(error => {
                alert('âŒ ë¹„êµ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:\n\n' + error.toString());
            });
        }

        function runHybridAPITest() {
            if (!GAS_URL || GAS_URL.includes('YOUR_SCRIPT_ID')) {
                alert('âš ï¸ Google Apps Script URLì„ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.');
                return;
            }

            alert('ğŸŒ í•˜ì´ë¸Œë¦¬ë“œ API í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...\n\n1. êµ¬ê¸€ Maps API: ì£¼ì†Œ ê²€ìƒ‰ + í•œê¸€ ë„ë¡œëª… ì£¼ì†Œ\n2. ë„¤ì´ë²„ Maps API: ì¢Œí‘œ ë³€í™˜\n3. í•˜ì´ë¸Œë¦¬ë“œ: ë‘ API ì¡°í•©\n\nê° ë‹¨ê³„ë³„ë¡œ ê²°ê³¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.');

            fetch(GAS_URL, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ action: 'testHybridAPI' })
            })
            .then(response => response.json())
            .then(data => {
                console.log('í•˜ì´ë¸Œë¦¬ë“œ API í…ŒìŠ¤íŠ¸ ê²°ê³¼:', data);
                
                let resultText = `ğŸŒ í•˜ì´ë¸Œë¦¬ë“œ API í…ŒìŠ¤íŠ¸ ê²°ê³¼\n\n`;
                resultText += `[ì „ì²´ ìƒíƒœ]\n${data.status}\n\n`;
                resultText += `[ë©”ì‹œì§€]\n${data.message}\n\n`;
                
                if (data.data) {
                    if (data.data.google) {
                        resultText += `[êµ¬ê¸€ Maps API ê²°ê³¼]\n`;
                        resultText += `ì›ë³¸ ì¿¼ë¦¬: ${data.data.google.originalQuery}\n`;
                        resultText += `í•œê¸€ ì£¼ì†Œ: ${data.data.google.formattedAddress}\n`;
                        resultText += `êµ¬ê¸€ ì¢Œí‘œ: (${data.data.google.coords.lat}, ${data.data.google.coords.lng})\n\n`;
                    }
                    
                    if (data.data.naver) {
                        resultText += `[ë„¤ì´ë²„ Maps API ê²°ê³¼]\n`;
                        resultText += `ë„¤ì´ë²„ ì¢Œí‘œ: (${data.data.naver.x}, ${data.data.naver.y})\n\n`;
                    }
                    
                    if (data.data.hybrid) {
                        resultText += `[í•˜ì´ë¸Œë¦¬ë“œ ìµœì¢… ê²°ê³¼]\n`;
                        resultText += `ìµœì¢… ì¢Œí‘œ: (${data.data.hybrid.lat}, ${data.data.hybrid.lng})\n`;
                        resultText += `í•œê¸€ ì£¼ì†Œ: ${data.data.hybrid.formattedAddress}\n`;
                        resultText += `ì†ŒìŠ¤: ${data.data.hybrid.source}\n\n`;
                    }
                }
                
                alert(resultText);
            })
            .catch(error => {
                alert('âŒ í•˜ì´ë¸Œë¦¬ë“œ API í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:\n\n' + error.toString());
            });
        }
    </script>
</body>
</html>